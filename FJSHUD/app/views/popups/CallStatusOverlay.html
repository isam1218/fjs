<div class="Overlay" ng-controller="CallStatusOverlayController">
	<div ng-click="showOverlay(false)" class="Background"></div>
	<div class="Foreground" ng-if="screen == 'call'">
		<div ng-click="showOverlay(false)" class="Close">x</div>
		
		<div class="Header">
			<h2>Call Management</h2>
		</div>
		
		<div class="Sections">
			<div class="Section">
				<div>
					<h4>Call Members</h4>
					<em>These contacts are talking</em>
				</div>
				<div class="Contact">
					<div class="Avatar AvatarNormal" context-menu="onCall">
						<img class="AvatarImgPH" data-ng-src="{{ onCall.getAvatar(28) }}" onerror="this.src='img/Generic-Avatar-28.png'" />
						<div class="AvatarForeground AvatarInteractable"></div>
					</div>
					<div class="Name">
						<strong>{{ onCall.displayName }}</strong>
						<br/>
						x{{ onCall.primaryExtension }}
					</div>
					
					<div class="Barging" ng-if="onCall.call.barge > 0">Barging</div>
					
					<div class="Time">{{ timeElapsed }}</div>
					
					<div class="Buttons">
						<input type="button" class="XButton" value="Barge" ng-click="bargeCall('barge', onCall.xpid)" ng-disabled="onCall.call.type != 4" />
						<input type="button" class="XButton" value="Monitor" ng-click="bargeCall('monitor', onCall.xpid)" ng-disabled="onCall.call.type != 4" />
						<input type="button" class="XButton" value="Whisper" ng-click="bargeCall('whisper', onCall.xpid)" ng-disabled="onCall.call.type != 4" />
						<input type="button" class="XButton" value="Transfer" ng-click="changeScreen('transfer', onCall.xpid)" ng-disabled="onCall.call.type != 4" />
					</div>
				</div>
				<div class="Contact">
					<div class="Avatar AvatarNormal" context-menu="onCall.call">
						<img class="AvatarImgPH" ng-src="{{ getCallStatusAvatar(onCall.call) }}" onerror="this.src='img/Generic-Avatar-28.png'" />
						<div class="AvatarForeground AvatarInteractable"></div>
					</div>
					<div class="Name">
						<strong>{{ onCall.call.displayName }}</strong>
						<br/>
						{{ onCall.call.phone }}
					</div>
					
					<div class="Time">{{ timeElapsed }}</div>
					
					<div class="Buttons">
						<input type="button" class="XButton" value="Barge" ng-click="bargeCall('barge', onCall.call.contactId)" ng-disabled="onCall.call.type != 4" />
						<input type="button" class="XButton" value="Monitor" ng-click="bargeCall('monitor', onCall.call.contactId)" ng-disabled="onCall.call.type != 4" />
						<input type="button" class="XButton" value="Whisper" ng-click="bargeCall('whisper', onCall.call.contactId)" ng-disabled="onCall.call.type != 4" />
						<input type="button" class="XButton" value="Transfer" ng-click="changeScreen('transfer', onCall.call.contactId)" ng-disabled="onCall.call.type != 4" />
					</div>
				</div>
			</div>
			
			<div class="Section">
				<div>
					<h4>Barged By</h4>
					<em>Contacts who barge the call</em>
				</div>
				
				<div class="Bargers">
					<div ng-repeat="barger in onCall.call.bargers" class="ListRow ListRow">
						<div class="Avatar AvatarNormal" context-menu="barger">
							<img class="AvatarImgPH" data-ng-src="{{::barger.getAvatar(28)}}" onerror="this.src='img/Generic-Avatar-28.png'" />
							<div class="AvatarForeground AvatarInteractable"></div>
						</div>
			
						<div class="ListRowContent">
							<div class="ListRowTitle">
								<div class="name">
									<strong>{{ ::barger.displayName }}</strong>
									<span>#{{ ::barger.primaryExtension }}</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="Footer">
			<div class="Error" ng-show="onCall.call.recorded">{{ recordingElapsed }}</div>
		
			<input type="button" class="XButton" value="{{ onCall.call.recorded ? 'Stop' : 'Start' }} Recording" ng-click="recordCall()" />
			<input type="button" class="XButton" value="Close" ng-click="showOverlay(false)" />
			<input type="button" class="XButton" value="Conferencing" ng-show="onCall.call.type == 4" ng-click="changeScreen('conference')" />
		</div>
	</div>
	
	<!-- transfer call -->
	<div class="Foreground" ng-show="screen == 'transfer'">
		<div ng-click="showOverlay(false)" class="Close">x</div>
		
		<div class="Header">
			<h2>Call Transfer</h2>
		</div>
		
		<div class="Sections">
			<div class="Section">
				<div>
					<h4>Contact to Transfer</h4>
					<em>This person will be transferred to the selected destination</em>
				</div>
				<div class="Contact">
					<div class="Avatar AvatarNormal">
						<img class="AvatarImgPH" data-ng-src="{{ transferFrom.getAvatar(28) }}" onerror="this.src='img/Generic-Avatar-28.png'" />
						<div class="AvatarForeground AvatarInteractable"></div>
					</div>
					<div class="Name">
						<strong>{{ transferFrom.displayName }}</strong>
						<br/>
						x{{ transferFrom.primaryExtension ? transferFrom.primaryExtension : transferFrom.phone }}
					</div>
					
					<div class="Time">{{ timeElapsed }}</div>
				</div>
			</div>
			
			<div class="Section" ng-show="!transferTo">
				<div>
					<h4>Destination</h4>
					<input type="search" class="Search" ng-model="tranQuery" placeholder="Search" />
				</div>
				<div class="Banner">CONTACTS</div>
				<div class="Members">
					<a href="" class="ListRow" ng-repeat="contact in contacts | filter: {displayName: tranQuery} track by contact.xpid" ng-click="selectDestination(contact)"> 
						<div class="Avatar AvatarNormal">
							<img class="AvatarImgPH" data-ng-src="{{::contact.getAvatar(28)}}" onerror="this.src='img/Generic-Avatar-28.png'" />
							<div class="AvatarForeground AvatarInteractable"></div>
						</div>
						<div class="ListRowContent">
							<div class="ListRowTitle">
								<strong>{{ ::contact.displayName }}</strong>
								<br/>
								<div class="ListRowStatusIcon XIcon-QueueStatus-{{contact.queue_status}}"></div>
								<div class="ListRowStatusIcon XIcon-ChatStatus-{{contact.hud_status || 'offline' }}"></div>
							</div>
						</div>
					</a>
				</div>
			</div>
			
			<div class="Section" ng-show="transferTo">
				<div>
					<h4>Office Destination</h4>
					<em>Call will be transferred to this contact</em>
				</div>
				<div>
					<a href="" class="ListRow"> 
						<div class="Avatar AvatarNormal">
							<img class="AvatarImgPH" data-ng-src="{{::transferTo.getAvatar(28)}}" onerror="this.src='img/Generic-Avatar-28.png'" />
							<div class="AvatarForeground AvatarInteractable"></div>
						</div>
						<div class="ListRowContent">
							<div class="ListRowTitle">
								<strong>{{ ::transferTo.displayName }}</strong>
								<br/>
								<div class="ListRowStatusIcon XIcon-QueueStatus-{{transferTo.queue_status}}"></div>
								<div class="ListRowStatusIcon XIcon-ChatStatus-{{transferTo.hud_status || 'offline' }}"></div>
							</div>
						</div>
					</a>
				</div>
				<div>
					<h4>Transfer Options</h4>
					<em>Call will be transferred to this contact</em>
				</div>
				<div>
					<input type="checkbox" ng-model="sendToPrimary" ng-value="{{sendToPrimary}}" ng-true-value="1" ng-false-value="0" /> Primary extension
					<br/>
					<input type="checkbox" ng-model="sendToPrimary" ng-value="{{sendToPrimary}}" ng-true-value="0" ng-false-value="1" /> Voicemail box
				</div>
			</div>
		</div>
		
		<div class="Footer">
			<div class="Error" ng-show="addError" ng-bind="addError"></div>
			
			<input type="button" class="XButton" value="Cancel" ng-click="changeScreen('call')" />
			<input type="button" class="XButton" value="Transfer" ng-click="transferCall()" />
		</div>
	</div>
	
	<!-- conferencing -->
	<div class="Foreground" ng-show="screen == 'conference'">
		<div ng-click="showOverlay(false)" class="Close">x</div>
		
		<div class="Header">
			<h2>Transfer to Conference Room</h2>
		</div>
		
		<div class="Sections">
			<div class="Section">
				<div>
					<h4>Contacts to Transfer</h4>
					<em>These contacts will be transferred to conference room</em>
				</div>
				<div>
					<div class="ListRow">
						<div class="Avatar AvatarNormal">
							<img class="AvatarImgPH" data-ng-src="{{::onCall.getAvatar(28)}}" onerror="this.src='img/Generic-Avatar-28.png'" />
							<div class="AvatarForeground AvatarInteractable"></div>
						</div>
						<div class="ListRowContent">
							<div class="ListRowTitle">
								<div class="name">
									<strong>{{ ::onCall.displayName }}</strong>
									<span>{{ ::onCall.primaryExtension }}</span>
								</div>
							</div>
						</div>
					</div>
					<div class="ListRow">
						<div class="Avatar AvatarNormal">
							<img class="AvatarImgPH" data-ng-src="{{::getCallStatusAvatar(onCall.call)}}" onerror="this.src='img/Generic-Avatar-28.png'" />
							<div class="AvatarForeground AvatarInteractable"></div>
						</div>
						<div class="ListRowContent">
							<div class="ListRowTitle">
								<div class="name">
									<strong>{{ ::onCall.call.displayName }}</strong>
									<span>{{ ::onCall.call.phone }}</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div>
					<h4>Options</h4>
					<em>Add yourself to the conference</em>
				</div>
				
				<input type="checkbox" ng-model="meToo" ng-true-value="1" ng-false-value="0" /> Join me as well
			</div>
			
			<div class="Section" ng-show="!selectedConf">
				<div>
					<h4>Conference Room</h4>
					<input type="search" class="Search" ng-model="confQuery" placeholder="Search by room or person" />
				</div>
				<div class="Members">
                    <a href="" class="ListRow ListRow-Conference" data-ng-repeat="conference in conferences | filter: customConfFilter() track by conference.xpid" ng-click="selectConference(conference)">
                        <div class="ConferenceAvatarSection Avatar AvatarNormal">
                            <div class="GroupAvatarItem GroupAvatarItem_0" context-menu="conference">
								<img class="GroupAvatarItemImg" ng-src="{{ conference.getAvatar(0, 14) }}" onerror="this.src='img/Generic-Avatar-14.png'" />
							</div>
                            <div class="GroupAvatarItem GroupAvatarItem_1">
								<img class="GroupAvatarItemImg" ng-src="{{ conference.getAvatar(1, 14) }}" onerror="this.src='img/Generic-Avatar-14.png'" />
							</div>
                            <div class="GroupAvatarItem GroupAvatarItem_2">
								<img class="GroupAvatarItemImg" ng-src="{{ conference.getAvatar(2, 14) }}" onerror="this.src='img/Generic-Avatar-14.png'" />
							</div>
							<div class="GroupAvatarItem GroupAvatarItem_3">
								<img class="GroupAvatarItemImg" ng-src="{{ conference.getAvatar(3, 14) }}" onerror="this.src='img/Generic-Avatar-14.png'" />
							</div>
							
                            <div class="AvatarInteractable"></div>
                        </div>
                        <div class="ListRowContent">
                            <div class="ListRowTitle">
                                <div class="name"> Room # {{::conference.roomNumber}} ({{::conference.extensionNumber}})</div>
								 
                                <div data-ng-if="conference.members.length == 0">
                                    <div class="ListConferenceStatusIcon XIcon-ChatStatus-Offline"></div>
									Free room
                                </div>                            
                                <div data-ng-if="conference.members.length > 0">
                                    <div class="ListRowStatusIcon XIcon-ChatStatus-Available"></div>
									{{conference.members.length}} member(s) on a call
								</div> 
                            </div>
                        </div>
                    </a>
				</div>
			</div>
			
			<div class="Section" ng-show="selectedConf">
				<div>
					<h4>Destination</h4>
				</div>
				
				<div>
					<a href="" class="ListRow ListRow-Conference">
						<div class="ConferenceAvatarSection Avatar AvatarNormal">
							<div class="GroupAvatarItem GroupAvatarItem_0">
								<img class="GroupAvatarItemImg" ng-src="{{ selectedConf.getAvatar(0, 14) }}" onerror="this.src='img/Generic-Avatar-14.png'" />
							</div>
							<div class="GroupAvatarItem GroupAvatarItem_1">
								<img class="GroupAvatarItemImg" ng-src="{{ selectedConf.getAvatar(1, 14) }}" onerror="this.src='img/Generic-Avatar-14.png'" />
							</div>
							<div class="GroupAvatarItem GroupAvatarItem_2">
								<img class="GroupAvatarItemImg" ng-src="{{ selectedConf.getAvatar(2, 14) }}" onerror="this.src='img/Generic-Avatar-14.png'" />
							</div>
							<div class="GroupAvatarItem GroupAvatarItem_3">
								<img class="GroupAvatarItemImg" ng-src="{{ selectedConf.getAvatar(3, 14) }}" onerror="this.src='img/Generic-Avatar-14.png'" />
							</div>
							
							<div class="AvatarInteractable"></div>
						</div>
						<div class="ListRowContent">
							<div class="ListRowTitle">
								<div class="name"> Room # {{::selectedConf.roomNumber}} ({{::selectedConf.extensionNumber}})</div>
								
								<div data-ng-if="selectedConf.members.length == 0">
									<div class="ListConferenceStatusIcon XIcon-ChatStatus-Offline"></div>
									Free room
								</div>                            
								<div data-ng-if="selectedConf.members.length > 0">
									<div class="ListRowStatusIcon XIcon-ChatStatus-Available"></div>
									{{selectedConf.members.length}} member(s) on a call
								</div> 
							</div>
							
							<div class="ListRowStatus" ng-if="selectedConf.location">
								at {{::selectedConf.location}}
							</div>
						</div>
					</a>
				</div>
				
				<div>
					<h4>Are you Ready?</h4>
					<em>Call will be transferred to this conference</em>
				</div>
			</div>
		</div>
		
		<div class="Footer">
			<div class="Error" ng-show="addError" ng-bind="addError"></div>
			
			<input type="button" class="XButton" value="Cancel" ng-click="changeScreen('call')" />
			<input type="button" class="XButton" value="Join" ng-click="joinConference()" />
		</div>
	</div>
</div>