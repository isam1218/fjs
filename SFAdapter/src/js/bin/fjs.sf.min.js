'use strict';var SFApi=function(){if(SFApi.__instance)return SFApi.__instance;SFApi.__instance=this};SFApi.PREFIX="Fon.";SFApi.FON_LOGIN_CLASS_NAME="FonLogin";SFApi.prototype.enableCalls=function(a){a?sforce.interaction.cti.enableClickToDial():sforce.interaction.cti.disableClickToDial()};SFApi.prototype.setPhoneApi=function(a,b){this.enableCalls(!0);sforce.interaction.cti.onClickToDial(b)};
SFApi.prototype.addCallLog=function(a,b,d,c,e,f,j,h){var i="Completed";null==b&&null==d&&(i="Not Started");var g="Subject="+encodeURIComponent(a)+"&CallType="+e+"&CallDurationInSeconds="+f+"&Status="+i+"&Type=Call&ActivityDate="+j;b&&(g+="&WhoId="+b);d&&(g+="&WhatId="+d);SFApi.prototype.getCalllogCommentField(function(a){var b="Description";a&&a.result&&(null!=a.result&&""!=a.result)&&(b=a.result);c&&(g+="&"+b+"="+encodeURIComponent(c));f&&j&&e?sforce.interaction.saveLog("Task",g,function(a){h(a)}):
fjs.utils.Console.error("Wrong arguments for adding call log.")})};SFApi.prototype.getPhoneInfo=function(a,b,d,c){sforce.interaction.searchAndGetScreenPopUrl(a,"",b,c)};SFApi.prototype.getPhoneInfoAndOpenPopup=function(a,b,d,c){sforce.interaction.searchAndScreenPop(a,"acc10="+b+"&con10="+b+"&lea8="+b,d,c)};SFApi.prototype.openUser=function(a,b){sforce.interaction.screenPop("/"+a,!0,b)};
SFApi.prototype.openCreateContactDialog=function(a){sforce.interaction.screenPop("/003/e?acc10="+a+"&con10="+a+"&lea8="+a,!0,function(){})};SFApi.prototype.setSoftphoneHeight=function(a,b){sforce.interaction.cti.setSoftphoneHeight(a,b)};SFApi.prototype.setSoftphoneWidth=function(a,b){sforce.interaction.cti.setSoftphoneWidth(a,b)};SFApi.prototype.getLoginInfo=function(a){sforce.interaction.runApex(SFApi.PREFIX+SFApi.FON_LOGIN_CLASS_NAME,"getLoginInfo",null,a)};
SFApi.prototype.getCalllogCommentField=function(a){sforce.interaction.runApex(SFApi.PREFIX+SFApi.FON_LOGIN_CLASS_NAME,"getCalllogFieldName",null,a)};namespace("fjs.sf");fjs.sf.SFSimpleProvider=function(){if(!fjs.sf.SFSimpleProvider.__instance){var a=new fjs.api.TabsSynchronizer,b=this;this.isMaster=a.isMaster;a.addEventListener("master_changed",function(){b.isMaster=a.isMaster});this.api=new SFApi;fjs.sf.SFSimpleProvider.__instance=this}return fjs.sf.SFSimpleProvider.__instance};
fjs.sf.SFSimpleProvider.prototype.sendAction=function(a){if(this.isMaster)switch(a.action){case "enableCalls":this.api.enableCalls(a.data.isReg,a.callback);break;case "addCallLog":this.api.addCallLog(a.data.subject,a.data.whoId,a.data.whatId,a.data.note,a.data.callType,a.data.duration,a.data.date,a.callback);break;case "getPhoneInfo":this.api.getPhoneInfo(a.data.phone,a.data.callType,a.data.isRinging,a.callback);break;case "getCalllogCommentField":this.api.getCalllogCommentField(a.callback)}switch(a.action){case "getLoginInfo":this.api.getLoginInfo(a.callback);
break;case "setSoftphoneHeight":this.api.setSoftphoneHeight(a.data.height,a.callback);break;case "setSoftphoneWidth":this.api.setSoftphoneWidth(a.data.width,a.callback);break;case "setPhoneApi":this.api.setPhoneApi(a.data.isPhoneReg,a.callback);break;case "openUser":this.api.openUser(a.data.id,a.callback);break;case "getPhoneInfoAndOpenPopup":this.api.getPhoneInfoAndOpenPopup(a.data.phoneSearch,a.data.phone,a.data.callType,a.callback)}};fjs.sf.SFSimpleProvider.check=function(){return!0};namespace("fjs.sf");
fjs.sf.SFApiProviderFactory=function(){this._providers={simple:fjs.sf.SFSimpleProvider}};fjs.sf.SFApiProviderFactory.prototype.getProvider=function(){return new fjs.sf.SFSimpleProvider};var sfa_model=angular.module("SF_API",[]);sfa_model.service("SFApi",fjs.sf.SFApiProviderFactory);namespace("fjs.model");fjs.model.EntryModel=function(a){this.xpid=this.xef001iver=this.xef001id=null;this.fill(a)};fjs.model.EntryModel.prototype.fill=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};
namespace("fjs.model");fjs.model.FeedModel=function(a,b){fjs.EventsSource.call(this);this.feedName=a;this.items={};this.order=[];this.dataManager=b;this.listeners={start:[],push:[],"delete":[],complete:[]};this.init()};fjs.model.FeedModel.extend(fjs.EventsSource);fjs.model.FeedModel.EVENT_TYPE_START="start";fjs.model.FeedModel.EVENT_TYPE_PUSH="push";fjs.model.FeedModel.EVENT_TYPE_DELETE="delete";fjs.model.FeedModel.EVENT_TYPE_CHANGE="change";fjs.model.FeedModel.EVENT_TYPE_COMPLETE="complete";
fjs.model.FeedModel.prototype.getEntryByXpid=function(a){return this.items[a]};fjs.model.FeedModel.prototype.init=function(){var a=this;this.dataManager.addEventListener(this.feedName,function(b){a.onSyncStart();for(var d in b.changes)if(b.changes.hasOwnProperty(d)){var c=b.changes[d];if(fjs.model.FeedModel.EVENT_TYPE_CHANGE==c.type)a.onEntryChange(c);else if(fjs.model.FeedModel.EVENT_TYPE_DELETE==c.type)a.onEntryDeletion(c);else fjs.utils.Console.error("Unknown change type:",c.type)}a.onSyncComplete()})};
fjs.model.FeedModel.prototype.prepareEntry=function(){};fjs.model.FeedModel.prototype.onSyncStart=function(a){this.fireEvent(fjs.model.FeedModel.EVENT_TYPE_START,a)};fjs.model.FeedModel.prototype.onEntryDeletion=function(a){var b=this.order.indexOf(this.items[a.xpid]);-1<b&&this.order.splice(b,1);delete this.items[a.xpid];this.fireEvent(fjs.model.FeedModel.EVENT_TYPE_DELETE,a)};
fjs.model.FeedModel.prototype.onEntryChange=function(a){var b=this.items[a.xpid];b?b.fill(a.entry):(b=this.items[a.xpid]=new fjs.model.EntryModel(a.entry),this.order.push(b));this.prepareEntry(b);this.fireEvent(fjs.model.FeedModel.EVENT_TYPE_PUSH,b)};fjs.model.FeedModel.prototype.onSyncComplete=function(a){this.fireEvent(fjs.model.FeedModel.EVENT_TYPE_COMPLETE,a)};
fjs.model.FeedModel.prototype.addEventListener=function(a,b){fjs.EventsSource.prototype.addEventListener.call(this,a,b);if(a==fjs.model.FeedModel.EVENT_TYPE_PUSH)for(var d in this.items)this.items.hasOwnProperty(d)&&b({eventType:fjs.model.FeedModel.EVENT_TYPE_PUSH,xpid:d,entry:this.items[d]})};namespace("fjs.model");fjs.model.MeModel=function(a){fjs.model.FeedModel.call(this,fjs.model.MeModel.NAME,a);this.property2key={};this.propertyKey2Xpid={}};fjs.model.MeModel.extend(fjs.model.FeedModel);
fjs.model.MeModel.prototype.onEntryChange=function(a){a.entry&&(a.entry.propertyKey?(this.propertyKey2Xpid[a.xpid]=a.entry.propertyKey,this.property2key[a.entry.propertyKey]=a.entry):this.property2key[this.propertyKey2Xpid[a.xpid]]=a.entry,this.superClass.onEntryChange.call(this,a))};
fjs.model.MeModel.prototype.onEntryDeletion=function(a){var b=this.propertyKey2Xpid[a.xpid];delete this.propertyKey2Xpid[a.xpid];this.property2key[b].xpid==a.xpid&&delete this.property2key[b];this.superClass.onEntryDeletion.call(this,a)};fjs.model.MeModel.prototype.getProperty=function(a){return this.property2key[a]&&this.property2key[a].propertyValue};fjs.model.MeModel.NAME="me";namespace("fjs.model");
fjs.model.MyCallsFeedModel=function(a){fjs.model.FeedModel.call(this,"mycallsclient",a);this.htCallIdToXpid={};this.listeners.changepid=[];this.changes={};this.clientSettingsModel=this.dataManager.getModel("clientsettings")};fjs.model.MyCallsFeedModel.extend(fjs.model.FeedModel);fjs.model.MyCallsFeedModel.prototype.prepareEntry=function(a){this.htCallIdToXpid[a.htCallId]=a.xpid};
fjs.model.MyCallsFeedModel.prototype.htCallIdByXpid=function(a){for(var b in this.htCallIdToXpid)if(this.htCallIdToXpid.hasOwnProperty(b)&&this.htCallIdToXpid[b]==a)return b};fjs.model.MyCallsFeedModel.prototype.onEntryDeletion=function(a){var b=this.htCallIdByXpid(a.xpid);this.changes[b]||(this.changes[b]={});this.changes[b].delete=a};
fjs.model.MyCallsFeedModel.prototype.onEntryChange=function(a){var b=this.items[a.xpid],b=b?b.htCallId:a.entry.htCallId;this.changes[b]||(this.changes[b]={});this.changes[b].push=a};
fjs.model.MyCallsFeedModel.prototype.getPhoneInfoAndOpenPopup=function(a,b){if(7!=a.type&&0==a.state&&a.incoming&&2==b.state&&document.hasFocus()){var d={},c=this;d.action="getPhoneInfoAndOpenPopup";d.data={};d.data.phoneSearch=a.getFormattedPhone();d.data.phone=a.phone;d.data.callType="inbound";d.callback=function(){a.fillCallLogData(data,c.dataManager.getModel("clientsettings"))&&c.dataManager.sendAction("mycallsclient","push",{callLog:a.mycallsclient_callLog,xpid:a.xpid})};this.dataManager.sf.sendAction(d)}};
fjs.model.MyCallsFeedModel.prototype.onSyncComplete=function(a){for(var b in this.changes){var d,c;if(this.changes.hasOwnProperty(b))if(c=this.changes[b],c.push&&!c.delete)d=c.push,(c=this.items[d.xpid])?(this.getPhoneInfoAndOpenPopup(c,d.entry),c.fill(d.entry)):(c=this.items[d.xpid]=new fjs.model.MyCallEntryModel(d.entry),this.order.push(c)),this.prepareEntry(c),this.fireEvent("push",c),(!this.clientSettingsModel.items.openedCall||null!=this.clientSettingsModel.items.openedCall.value&&!this.items[this.clientSettingsModel.items.openedCall.value])&&
(2==c.state||0==c.state)&&this.dataManager.sendAction("clientsettings","push",{xpid:"openedCall",value:c.xpid}),fjs.utils.Console.log("!!!!push ",d.xpid,d.entry);else if(!c.push&&c.delete)d=c.delete,c=this.order.indexOf(this.items[d.xpid]),-1<c&&this.order.splice(c,1),delete this.items[d.xpid],this.fireEvent("delete",d),fjs.utils.Console.log("!!!!delete ",d.xpid);else if(c.push&&c.delete){d=c.delete;var e=c.push;c=this.items[d.xpid];this.getPhoneInfoAndOpenPopup(c,e.entry);c.fill(e.entry);delete this.items[d.xpid];
this.prepareEntry(c);this.items[e.xpid]=c;var f=this.clientSettingsModel.getEntryByXpid("openedCall");f&&f.value==d.xpid&&this.dataManager.sendAction("clientsettings","push",{xpid:"openedCall",value:e.xpid});c.oldPid=d.xpid;c.pidChanged=!0;e.eventType="changepid";this.fireEvent("changepid",c);fjs.utils.Console.log("!!!!changepid ","from:",c.oldPid,"to:",e.xpid)}}this.changes={};this.fireEvent("complete",a);fjs.utils.Console.log("!!!OnCallsSyncEnd!!!")};fjs.model.MyCallsFeedModel.NAME="mycallsclient";
namespace("fjs.model");fjs.model.MyCallEntryModel=function(a){this._who=[];this._what=[];var b=new Date;this.mycallsclient_callLog={date:b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate(),subject:"Call",xpid:this.xpid,note:"",callType:this.incoming?"inbound":"outbound",isOpened:!0,tranferOpened:!1,whatId:null,whoId:null,related:[]};fjs.model.EntryModel.call(this,a)};fjs.model.MyCallEntryModel.extend(fjs.model.EntryModel);
fjs.model.MyCallEntryModel.prototype.getFormattedPhone=function(){if(this.phone){var a=this.phone.replace(/[^0-9]/g,"");10<a.length&&(a=a.slice(a.length-10,a.length));var b=null;4<a.length&&(b=a.split("").reverse().join(""),7<b.length&&10>=b.length&&(b=b.replace(/(\d{4})(\d{3})(\d{3}|\d{2}|\d{1})/,"$1-$2-$3")),4<b.length&&7>=b.length&&(b=b.replace(/(\d{4})(\d{3}|\d{2}|\d{1})/,"$1-$2")),b=b.split("").reverse().join(""));b&&(a+=" or "+b);return a}return null};
fjs.model.MyCallEntryModel.HOLD_CALL_TYPE=3;fjs.model.MyCallEntryModel.RING_CALL_TYPE=0;fjs.model.MyCallEntryModel.prototype.onHold=function(){return this.state==fjs.model.MyCallEntryModel.HOLD_CALL_TYPE};fjs.model.MyCallEntryModel.prototype.isRing=function(){return this.state==fjs.model.MyCallEntryModel.RING_CALL_TYPE};
fjs.model.MyCallEntryModel.prototype.getWho=function(a){for(var b=0;b<this.mycallsclient_callLog.related.length;b++){var d=this.mycallsclient_callLog.related[b];if("who"==this.getRelatedItemType(d)&&(!a||"Lead"!=d.object))return d}};fjs.model.MyCallEntryModel.prototype.getWhat=function(){for(var a=0;a<this.mycallsclient_callLog.related.length;a++){var b=this.mycallsclient_callLog.related[a];if("what"==this.getRelatedItemType(b))return b}};
fjs.model.MyCallEntryModel.prototype.findCallLogTargetById=function(a){for(var b=0;b<this.mycallsclient_callLog.related.length;b++){var d=this.mycallsclient_callLog.related[b];if(d._id==a)return d}};fjs.model.MyCallEntryModel.prototype.getRelatedItemType=function(a){return"Contact"==a.object||"Lead"==a.object?"who":"what"};
fjs.model.MyCallEntryModel.prototype.fillCallLogData=function(a,b){var d=this.mycallsclient_callLog.whatId,c=this.mycallsclient_callLog.whoId,e=!1;this.mycallsclient_callLog._notNew||(this.mycallsclient_callLog._notNew=e=!0);this.pidChanged&&(e=!0,this.pidChanged=!1);var f=b.items.phoneMap&&b.items.phoneMap.phones||{};if(a&&a.result){var j=fjs.utils.JSON.parse(a.result),h;for(h in j)if(j.hasOwnProperty(h)&&"screenPopUrl"!=h&&"CaseComment"!=j[h].object){var i=j[h];i._id=h;"Case"==i.object&&(i.Name=
i.CaseNumber);var g=this.findCallLogTargetById(h);g?g.Name!=i.Name&&(g.Name=i.Name,e=!0):(g=i,this.mycallsclient_callLog.related.push(g),e=!0);g.new=!0}}j=this.mycallsclient_callLog.related.slice(0);for(h=0;h<j.length;h++)if(i=j[h],i.new)i.new=!1;else{var k=this.mycallsclient_callLog.related.indexOf(i);-1<k&&(this.mycallsclient_callLog.related.splice(k,1),this.mycallsclient_callLog.pervWhatId==i._id&&(this.mycallsclient_callLog.pervWhatId=null),e=!0)}fjs.model.filter.SortRelatedFields()(this.mycallsclient_callLog.related);
if((f=f[this.phone])&&(g=this.findCallLogTargetById(f.id)))"who"==this.getRelatedItemType(g)?(this.mycallsclient_callLog.whoId=f.id,"Lead"!=g.object?(g=this.getWhat(),this.mycallsclient_callLog.whatId=g&&g._id):this.mycallsclient_callLog.whatId=null):(h=this.getWho(!0),this.mycallsclient_callLog.whoId=h&&h._id,this.mycallsclient_callLog.whatId=f.id);else if(h=this.findCallLogTargetById(this.mycallsclient_callLog.whoId),g=this.findCallLogTargetById(this.mycallsclient_callLog.whatId),h)!g&&"Lead"!=
h.object&&(g=this.getWhat(),this.mycallsclient_callLog.whatId=g&&g._id);else if(h=this.getWho(),this.mycallsclient_callLog.whoId=h&&h._id,!g&&(!h||"Lead"!=h.object))g=this.getWhat(),this.mycallsclient_callLog.whatId=g&&g._id;f&&b.deletePhone(this.phone);return e||d!=this.mycallsclient_callLog.whatId||c!=this.mycallsclient_callLog.whoId};
fjs.model.MyCallEntryModel.prototype.fill=function(a,b){b=b||this;if(a)for(var d in a)if(a.hasOwnProperty(d)){var c=a[d];if("object"!=typeof c||null==c){if("note"!=d||!this._blockChangeNote)b[d]=c;"note"==d&&c?b.subject="Call: "+(240<c.length?c.substr(0,240)+" ...":c):"note"==d&&""==c&&(b.subject="Call")}else Array.isArray(c)?b[d]=[]:b[d]||(b[d]={}),this.fill(c,b[d])}};
fjs.model.MyCallEntryModel.prototype.showRelated=function(){var a=this.findCallLogTargetById(this.mycallsclient_callLog.whoId);return this.getWhat()&&(!a||"Lead"!=a.object)};namespace("fjs.model");fjs.model.ClientSettingsFeedModel=function(a){fjs.model.FeedModel.call(this,"clientsettings",a)};fjs.model.ClientSettingsFeedModel.extend(fjs.model.FeedModel);
fjs.model.ClientSettingsFeedModel.prototype.savePhone=function(a,b){if(this.items.phoneMap)this.items.phoneMap.phones[a]=b,this.dataManager.sendAction("clientsettings","push",this.items.phoneMap);else{var d={xpid:"phoneMap",phones:{}};d.phones[a]=b;this.dataManager.sendAction("clientsettings","push",d)}};fjs.model.ClientSettingsFeedModel.prototype.deletePhone=function(a){this.items.phoneMap&&(delete this.items.phoneMap.phones[a],this.dataManager.sendAction("clientsettings","push",this.items.phoneMap))};
namespace("fjs.model.filter");fjs.model.filter.What=function(){return function(a){return a.filter(function(a){return"Contact"!=a.object&&"Lead"!=a.object})}};namespace("fjs.model.filter");fjs.model.filter.Who=function(){return function(a){return a.filter(function(a){return"Contact"==a.object||"Lead"==a.object})}};namespace("fjs.model.filter");
fjs.model.filter.SortRelatedFields=function(){return function(a){a.sort(function(a,b){return a.object>b.object?1:a.object<b.object?-1:a.Name.toLowerCase()>b.Name.toLowerCase()?1:a.Name.toLowerCase()<b.Name.toLowerCase()?-1:0});var b=null,d=null,c=0;a.forEach(function(a){b!=a.object?(c=0,b=a.object,d=a):a.title="";c++;d.title=b+" ("+c+")"})}};namespace("fjs.model.filter");fjs.model.filter.HasCallInfoFilter=function(){return function(a){return a.filter(function(a){return!!a.htCallId})}};namespace("fjs.model");
fjs.model.DataManager=function(a){fjs.EventsSource.call(this);this.feeds={};this.node=this.ticket=null;this.phoneMap={};this.state=-1;this.suspendFeeds=[];this.suspendActions=[];this.warningListeners={};this.loginInfo={};this.sf=a.getProvider();var b=this,d=new fjs.api.FDPProviderFactory;this.authErrorCount=0;this.MAX_AUTH_ERROR_COUNT=3;this.tabSynchronizer=new fjs.api.TabsSynchronizer;this.checkLoginTimeoutId=null;var c=function(a){var a=a&&a.result&&JSON.parse(a.result),c=a.number;if(c){var d={};
d.id=a.objectId;d.type=a.object;b.getModel("clientsettings").savePhone(c,d);b.sendAction(fjs.model.MeModel.NAME,"callTo",{phoneNumber:c})}};this.checkDevice=function(){var a={action:"setPhoneApi",data:{}};a.data.isReg=!0;a.callback=c;b.sf.sendAction(a)};this.checkDevice();var e=function(){null!=b.checkLoginTimeoutId&&clearInterval(b.checkLoginTimeoutId);b.checkLoginTimeoutId=setInterval(function(){b._getAuthInfo(function(a){a&&(b._authInfoChanged(a)&&b.dataProvider&&b.state)&&(fjs.utils.Cookies.remove(fjs.model.DataManager.AUTH_COOKIE_NAME),
b.dataProvider.sendMessage({action:"SFLogin",data:a}))})},9E5)};this.tabSynchronizer.isMaster&&e();this.tabSynchronizer.addEventListener("master_changed",function(){b.tabSynchronizer.isMaster?e():clearInterval(b.checkLoginTimeoutId)});this._getAuthInfo(function(a){a&&(b._authInfoChanged(a)||!b._getAccessInfo()?(fjs.utils.Cookies.remove(fjs.model.DataManager.AUTH_COOKIE_NAME),b.dataProvider=d.getProvider(null,null,function(){b.dataProvider.sendMessage({action:"SFLogin",data:a});b.state=1})):b.dataProvider=
d.getProvider(b.ticket,b.node,function(){b.state=1;if(0<b.suspendFeeds.length){for(var a=0;a<b.suspendFeeds.length;a++)b.dataProvider.addSyncForFeed(b.suspendFeeds[a]);b.suspendFeeds=[]}if(0<b.suspendActions.length){for(a=0;a<b.suspendActions.length;a++)b.dataProvider.sendMessage(b.suspendActions[a]);b.suspendActions=[]}}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_SYNC,function(a){a=a.data||a;b.fireEvent(a.feed,a)}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_AUTH_ERROR,
function(a){if(b.authErrorCount<b.MAX_AUTH_ERROR_COUNT){b._getAuthInfo(function(a){b.dataProvider.sendMessage({action:"SFLogin",data:a})});b.authErrorCount++}else b.fireWarningEvent(fjs.model.DataManager.AUTHORIZATION_STATE,a)}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_REQUEST_ERROR,function(a){fjs.utils.Console.error(a)}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_NETWORK_PROBLEM,function(a){fjs.utils.Console.error(a);b.fireWarningEvent(fjs.model.DataManager.CONNECTION_STATE,
{eventType:fjs.model.DataManager.EV_NETWORK_PROBLEM,connected:false,message:"Network problem"})}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_CONNECTION_ESTABLISHED,function(a){fjs.utils.Console.info(a);b.fireWarningEvent(fjs.model.DataManager.CONNECTION_STATE,{eventType:fjs.model.DataManager.EV_CONNECTION_ESTABLISHED,connected:true,message:""})}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_NODE,function(a){fjs.utils.Cookies.set(fjs.model.DataManager.NODE_COOKIE_NAME,b.node=
a.data.nodeId)}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_TICKET,function(a){fjs.utils.Cookies.set(fjs.model.DataManager.AUTH_COOKIE_NAME,b.ticket=a.data.ticket);b.fireWarningEvent(fjs.model.DataManager.AUTHORIZATION_STATE,a);if(b.suspendFeeds.length>0){for(a=0;a<b.suspendFeeds.length;a++)b.dataProvider.addSyncForFeed(b.suspendFeeds[a]);b.suspendFeeds=[]}if(b.suspendActions.length>0){for(a=0;a<b.suspendActions.length;a++)b.dataProvider.sendMessage(b.suspendActions[a]);b.suspendActions=
[]}}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_FDP_TIME,function(a){(new fjs.utils.TimeSync).setTimestamp(a.data)}))})};fjs.model.DataManager.extend(fjs.EventsSource);fjs.model.DataManager.AUTHORIZATION_STATE="Authorization";fjs.model.DataManager.CONNECTION_STATE="Connection";fjs.model.DataManager.EV_SYNC="sync";fjs.model.DataManager.EV_AUTH_ERROR="authError";fjs.model.DataManager.EV_REQUEST_ERROR="requestError";fjs.model.DataManager.EV_NETWORK_PROBLEM="networkProblem";
fjs.model.DataManager.EV_CONNECTION_ESTABLISHED="connectionEstablished";fjs.model.DataManager.EV_TICKET="ticket";fjs.model.DataManager.EV_NODE="node";fjs.model.DataManager.EV_FDP_CONFIG_ERROR="fdpConfigError";fjs.model.DataManager.EV_FDP_CONFIG="fdpConfig";fjs.model.DataManager.EV_FDP_TIME="fdpTime";fjs.model.DataManager.AUTH_COOKIE_NAME="SF_Authorization";fjs.model.DataManager.NODE_COOKIE_NAME="SF_Node";fjs.model.DataManager.CLIENT_ID_COOKIE_NAME="SF_Client_id";
fjs.model.DataManager.SERVER_URL_COOKIE_NAME="SF_ServerUrl";fjs.model.DataManager.HUD_LOGIN_COOKIE_NAME="SF_Login";fjs.model.DataManager.HUD_EMAIL_COOKIE_NAME="SF_Email";fjs.model.DataManager.ADM_LOGIN_COOKIE_NAME="SF_ADM_Login";
fjs.model.DataManager.prototype.getModel=function(a){if(!this.feeds[a])switch(a){case fjs.model.MeModel.NAME:this.feeds[a]=new fjs.model.MeModel(this);break;case "mycallsclient":this.feeds[a]=new fjs.model.MyCallsFeedModel(this);break;case "clientsettings":this.feeds[a]=new fjs.model.ClientSettingsFeedModel(this);break;default:this.feeds[a]=new fjs.model.FeedModel(a,this)}return this.feeds[a]};
fjs.model.DataManager.prototype.sendAction=function(a,b,d){a={action:"fdp_action",data:{feedName:a,actionName:b,params:d}};1==this.state?this.dataProvider.sendMessage(a):this.suspendActions.push(a)};
fjs.model.DataManager.prototype._authInfoChanged=function(a){var b=!1;if((fjs.utils.Cookies.get(fjs.model.DataManager.HUD_LOGIN_COOKIE_NAME)||this.loginInfo.hud)!=a.hud+"")this.tabSynchronizer.isMaster&&fjs.utils.Cookies.set(fjs.model.DataManager.HUD_LOGIN_COOKIE_NAME,a.hud),this.loginInfo.hud=a.hud+"",b=!0;if((fjs.utils.Cookies.get(fjs.model.DataManager.ADM_LOGIN_COOKIE_NAME)||this.loginInfo.login)!=a.login+"")this.tabSynchronizer.isMaster&&fjs.utils.Cookies.set(fjs.model.DataManager.ADM_LOGIN_COOKIE_NAME,
a.login+""),this.loginInfo.login=a.login+"",b=!0;if((fjs.utils.Cookies.get(fjs.model.DataManager.HUD_EMAIL_COOKIE_NAME)||this.loginInfo.email)!=a.email+"")this.tabSynchronizer.isMaster&&fjs.utils.Cookies.set(fjs.model.DataManager.HUD_EMAIL_COOKIE_NAME,a.email+""),this.loginInfo.email=a.email+"",b=!0;return b};
fjs.model.DataManager.prototype._getAccessInfo=function(){this.ticket=fjs.utils.Cookies.get(fjs.model.DataManager.AUTH_COOKIE_NAME);this.node=fjs.utils.Cookies.get(fjs.model.DataManager.NODE_COOKIE_NAME);return this.ticket};
fjs.model.DataManager.prototype._getAuthInfo=function(a){var b={},d=this;b.action="getLoginInfo";b.callback=function(b){var e=null,f=null;b&&(b.error?(fjs.utils.Console.error("SF response error",b.error),a(null)):f=JSON.parse(b.result));f&&((e={login:f.admLogin,token:f.admPassword,email:f.email},f.hudLogin&&(e.hud=f.hudLogin),f.serverUrl)?(fjs.fdp.CONFIG.SERVER.serverURL=f.serverUrl,d.fireWarningEvent(fjs.model.DataManager.CONNECTION_STATE,{eventType:fjs.model.DataManager.EV_FDP_CONFIG,message:""})):
d.fireWarningEvent(fjs.model.DataManager.CONNECTION_STATE,{eventType:fjs.model.DataManager.EV_FDP_CONFIG_ERROR,message:"Server URL was not specified"}));a(e)};this.sf.sendAction(b)};fjs.model.DataManager.prototype.addEventListener=function(a,b){if(!this.listeners[a]||0==this.listeners[a].length)1!=this.state&&0>this.suspendFeeds.indexOf(a)?this.suspendFeeds.push(a):this.dataProvider.addSyncForFeed(a);this.superClass.addEventListener.call(this,a,b)};
fjs.model.DataManager.prototype.addWarningListener=function(a,b){if(this.warningListeners[a])this.warningListeners[a].push(b);else{var d=[];d.push(b);this.warningListeners[a]=d}};fjs.model.DataManager.prototype.removeWarningListener=function(a,b){var d=this.warningListeners[a].indexOf(b);-1<d&&this.warningListeners[a].splice(d,1)};fjs.model.DataManager.prototype.fireWarningEvent=function(a,b){var d=this.warningListeners[a];if(d)for(var c=0;c<d.length;c++)d[c](b)};
sfa_model=angular.module("SFA_model",["SF_API"]);sfa_model.service("DataManager",["SFApi",fjs.model.DataManager]);sfa_model.filter("WhoFilter",fjs.model.filter.Who);sfa_model.filter("WhatFilter",fjs.model.filter.What);sfa_model.filter("SortRelatedFields",fjs.model.filter.SortRelatedFields);sfa_model.filter("HasCallInfoFilter",fjs.model.filter.HasCallInfoFilter);namespace("fjs.controllers");fjs.controllers.CommonController=function(){};
fjs.controllers.CommonController.prototype.safeApply=function(a,b){var d=a.$root.$$phase;"$apply"==d||"$digest"==d?b&&"function"===typeof b&&b():a.$apply(b)};fjs.controllers.CommonController.COMPLETE_LISTENER="complete";fjs.controllers.CommonController.PUSH_LISTENER="push";fjs.controllers.CommonController.DELETE_LISTENER="delete";namespace("fjs.controllers");
fjs.controllers.CallController=function(a,b,d,c,e,f,j){function h(b){if((m=a.call.phone)&&(!a.call.mycallsclient_callLog._notNew||b)&&a.call.type!=fjs.controllers.CallController.SYSTEM_CALL_TYPE){var c={action:"getPhoneInfo",data:{}};c.data.phone=a.call.getFormattedPhone();c.data.callType=a.call.incoming?"inbound":"outbound";c.data.isRinging=0==a.call.state;c.callback=function(c){a.call.fillCallLogData(c,t)&&(i(),l&&l.safeApply(a));b&&b(c)};q.sendAction(c)}}function i(){null!=o&&(clearTimeout(o),
o=null);o=setTimeout(function(){f.sendAction("mycallsclient","push",{callLog:a.call.mycallsclient_callLog,xpid:a.call.xpid})},fjs.controllers.CallController.CALL_LOG_CHANGE_DELAY_IN_SEC)}function g(){a.call.mycallsclient_callLog.isOpened=!0;a.call.mycallsclient_callLog.tranferOpened=!1;i()}fjs.controllers.CommonController(this);var k=null,n=new fjs.utils.TimeSync,m=null,l=this,o=null,q=j.getProvider(),t=f.getModel("clientsettings"),u=f.getModel("me"),v=f.getModel("locations");a.getTriangle=function(){return e.trustAsHtml(a.call.mycallsclient_callLog.isOpened?
fjs.controllers.CallController.OPENED_TRIANGLE:fjs.controllers.CallController.CLOSED_TRIANGLE)};a.isAutoAnswer=function(){var b=u.getProperty("current_location"),b=v.getEntryByXpid(b);return a.call.incoming&&b&&b.location_status_autoAnswer};new fjs.api.TabsSynchronizer;var r=function(){var b=(new Date).getTime()-n.getDefault()+6E4*(new Date(1)).getTimezoneOffset(),f=b-a.call.created,b=b-a.call.holdStart;a.call.duration=c("date")(new Date(f),"HH:mm:ss ");a.call.onHold()&&(a.call.holdDuration=c("date")(new Date(b),
"HH:mm:ss "));k=d(r,fjs.controllers.CallController.CALL_DURATION_DELAY_IN_SEC)};r();var p=null;a.noteKeyPress=function(){a.call._blockChangeNote=!0;null!=p&&(clearTimeout(p),p=null);p=setTimeout(function(){delete a.call._blockChangeNote;p=null},1E3)};a.showAddButton=function(){return 0==a.call.mycallsclient_callLog.related.length&&a.call.type!=fjs.controllers.CallController.SYSTEM_CALL_TYPE};a.whoChange=function(){var b=a.call.findCallLogTargetById(a.call.mycallsclient_callLog.whoId);b&&"Lead"==b.object?
(a.call.mycallsclient_callLog.pervWhatId=a.call.mycallsclient_callLog.whatId,a.call.mycallsclient_callLog.whatId=null):null==a.call.mycallsclient_callLog.whatId&&(a.call.mycallsclient_callLog.pervWhatId?a.call.mycallsclient_callLog.whatId=a.call.mycallsclient_callLog.pervWhatId:(b=a.call.getWhat(),a.call.mycallsclient_callLog.whatId=b&&b._id));i()};a.whatChange=function(){i()};a.noteChange=function(){i()};a.$watch("call.phone",function(b,c){b!=c&&(a.call.mycallsclient_callLog._notNew=!1);h()});a.hold=
function(){f.sendAction(fjs.model.MyCallsFeedModel.NAME,"transferToHold",{mycallId:a.call.xpid});return!1};a.accept=function(){f.sendAction(fjs.model.MyCallsFeedModel.NAME,"answer",{mycallId:a.call.xpid});return!1};a.transfer=function(){a.call.mycallsclient_callLog.tranferOpened?(a.call.mycallsclient_callLog.tranferOpened=!1,a.call.mycallsclient_callLog.isOpened=!0):(a.call.mycallsclient_callLog.tranferOpened=!0,a.call.mycallsclient_callLog.isOpened=!1);i()};a.end=function(){f.sendAction(fjs.model.MyCallsFeedModel.NAME,
"hangup",{mycallId:a.call.xpid});return!1};a.unhold=function(){f.sendAction(fjs.model.MyCallsFeedModel.NAME,"transferFromHold",{mycallId:a.call.xpid});return!1};a.toggleCallLog=function(){a.call.mycallsclient_callLog.isOpened?(a.call.mycallsclient_callLog.isOpened=!1,i()):g()};a.createContact=function(){(new SFApi).openCreateContactDialog(a.call.phone)};a.openSFLink=function(a){var b={action:"openUser",data:{}};b.data.id=a;q.sendAction(b)};a.closeTransferDialog=function(){g()};a.$on("transfer",function(b,
c){c&&f.sendAction(fjs.model.MyCallsFeedModel.NAME,"transferTo",{mycallId:a.call.xpid,toNumber:c});g()});var s=function(b){b=b||a;return b.showSaveCallLogDialog?b.showSaveCallLogDialog:s(b.$parent)};a.$on("$destroy",function(){k&&d.cancel(k);if(a.call.mycallsclient_callLog&&0<a.call.mycallsclient_callLog.related.length&&a.call.type!=fjs.controllers.CallController.SYSTEM_CALL_TYPE){if(a.call.type==fjs.controllers.CallController.QUEUE_CALL_TYPE&&a.call.state==fjs.controllers.CallController.RING_CALL_TYPE&&
a.call.incoming){console.log("Skip queue ring callLog",a.callLog);return}var b={action:"addCallLog",data:{}};b.data.subject=a.call.mycallsclient_callLog.subject;b.data.whoId=a.call.mycallsclient_callLog.whoId;b.data.whatId=a.call.mycallsclient_callLog.whatId;b.data.note=a.call.mycallsclient_callLog.note;b.data.callType=a.call.incoming?"inbound":"outbound";b.data.duration=Math.round(((new Date).getTime()-(a.call.created+n.getDefault()))/1E3);b.data.date=a.call.mycallsclient_callLog.date;b.callback=
function(a){fjs.utils.Console.error(a)};q.sendAction(b)}else if(a.call.type!=fjs.controllers.CallController.SYSTEM_CALL_TYPE){var c=s();h(function(){c(a.call)})}l=null;clearTimeout(o)})};fjs.controllers.CallController.extend(fjs.controllers.CommonController);fjs.controllers.CallController.CONFERENCE_CALL_TYPE=0;fjs.controllers.CallController.SYSTEM_CALL_TYPE=7;fjs.controllers.CallController.QUEUE_CALL_TYPE=3;fjs.controllers.CallController.HOLD_CALL_TYPE=3;
fjs.controllers.CallController.RING_CALL_TYPE=0;fjs.controllers.CallController.TALCKING_CALL_TYPE=2;fjs.controllers.CallController.OPENED_TRIANGLE="&#9660;";fjs.controllers.CallController.CLOSED_TRIANGLE="&#9658;";fjs.controllers.CallController.SORT_FIELD_NAME="Name";fjs.controllers.CallController.CALL_GET_INFO_DELAY_IN_SEC=3E3;fjs.controllers.CallController.CALL_DURATION_DELAY_IN_SEC=1E3;fjs.controllers.CallController.CALL_LOG_CHANGE_DELAY_IN_SEC=500;namespace("fjs.controllers");
fjs.controllers.CallsListController=function(a,b){this.callsFeedModel=b.getModel("mycallsclient");var d=this;fjs.controllers.CommonController.call(this,a);var c=b.getModel("clientsettings");a.calls=this.callsFeedModel.order;a.selectedCallId=c.items.openedCall&&c.items.openedCall.value;a.selectCall=function(c){a.selectedCallId=a.selectedCallId!=c?c:null;b.sendAction("clientsettings","push",{xpid:"openedCall",value:a.selectedCallId})};this.clientSettingsListener=function(){a.selectedCallId=c.items.openedCall&&
c.items.openedCall.value;d.safeApply(a)};this.completeCallsListener=function(){d.safeApply(a)};c.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.clientSettingsListener);this.callsFeedModel.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.completeCallsListener)};fjs.controllers.CallsListController.extend(fjs.controllers.CommonController);fjs.controllers.CallsListController.SELECTED_CALL_ID="selected_call_id";
fjs.controllers.CallsListController.SELECTED_CALL_ID_MODE="selected_call_id_mode";namespace("fjs.controllers");
fjs.controllers.MainController=function(a,b,d,c){fjs.controllers.CommonController(this);var e=this,f=c.getProvider(),j=!1,h=null,i=new fjs.utils.TimeSync;this.clientSettingsModel=d.getModel(fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL);this.clientSettingsModel.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,function(){e.clientSettingsModel.items[fjs.controllers.MainController.IS_WARNING_SHOWN]&&(a.isWarningsShown=e.clientSettingsModel.items[fjs.controllers.MainController.IS_WARNING_SHOWN].value,
e.safeApply(a))});this.meModel=d.getModel(fjs.model.MeModel.NAME);this.SOFTPHONE_HEIGHT=this.SOFTPHONE_WIDTH=200;this.FRAME_RESIZE_NAME="resizeFrame";a.isConnected=!0;a.warningsTemplatePath="templates/warnings.html";a.isWarningsShown=!1;a.loggined=!0;a.connection=!0;a.phone=!0;a.isLocationRegistered=!0;a.fdpConfigured=!0;a.fdpErrorMessage="";a.dialogTemplate=null;a.dialogModel=null;var g=function(){var a=fjs.utils.Browser;if(k.clientHeight!=n&&(a.isIE()||a.isSafari()))b[0].style.visibility="hidden";
null!=m&&(clearTimeout(m),m=null);m=setTimeout(function(){var c=k.clientHeight;if(c!=n){var d={action:"setSoftphoneHeight",data:{}};d.data.height=k.clientHeight;d.callback=function(){m=null};f.sendAction(d)}if(a.isIE()||a.isSafari())b[0].style.visibility="visible";n=c},100)},c={action:"setSoftphoneHeight",data:{}};c.data.height=e.SOFTPHONE_HEIGHT;f.sendAction(c);c={action:"setSoftphoneWidth",data:{}};c.data.width=e.SOFTPHONE_WIDTH;f.sendAction(c);var k=document.getElementById(e.FRAME_RESIZE_NAME),
n=k.clientHeight,m=null;document.body.onresize=function(){g()};setTimeout(function(){frame.onresize=function(){g()}},200);a.showBrowserWarning=function(){if(null===h){var a=!0;if(fjs.utils.Browser.isSafari())try{window.openDatabase("test","","test",1024)}catch(b){a=!1}h=!fjs.utils.Cookies.check()||!fjs.utils.LocalStorage.check()||!a}return h&&!j};a.getBrowserWarningLink=function(){return"http://www.fonality.com/crmlink/"+fjs.utils.Browser.getBrowserName()};a.getBrowserWarningMessage=function(){return"Click here for "+
fjs.utils.Browser.getBrowserName()+" instructions."};a.closeBrowserWarning=function(){j=!0};a.showWarnings=function(){a.isWarningsShown=!0;e.safeApply(a);d.sendAction(fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL,"push",{xpid:fjs.controllers.MainController.IS_WARNING_SHOWN,value:a.isWarningsShown})};a.showLoadingPanel=function(){return!a.name&&!a.isWarningsShown&&a.loggined&&a.connection&&a.fdpConfigured};a.hideWarnings=function(){a.isWarningsShown=!1;e.safeApply(a);d.sendAction(fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL,
"push",{xpid:fjs.controllers.MainController.IS_WARNING_SHOWN,value:a.isWarningsShown})};a.toggleWarnings=function(){a.isWarningsShown?a.hideWarnings():a.showWarnings()};var l=function(){a.isWarningsButtonShown=!a.loggined||!a.connection||!a.isLocationRegistered||!a.fdpConfigured;a.loggined&&(a.connection&&a.isLocationRegistered&&a.fdpConfigured)&&(a.isWarningsShown=!1,d.sendAction(fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL,"push",{xpid:fjs.controllers.MainController.IS_WARNING_SHOWN,
value:a.isWarningsShown}));e.safeApply(a)};this.meListener=function(){var b=e.meModel.getProperty("display_name");a.name=b?"User: "+b:"";b=e.meModel.getProperty("primary_extension");a.extension=b?"Extension: x"+b:"";e.safeApply(a)};this.authorizationWarningListener=function(b){b.eventType==fjs.model.DataManager.EV_TICKET?(a.loggined=!0,a.authErrorMessage=""):b.eventType==fjs.model.DataManager.EV_AUTH_ERROR&&(a.loggined=!1,a.authErrorMessage=b.message);l();a.isConnected=a.connection&&a.loggined;e.safeApply(a)};
this.connectionWarningListener=function(b){setTimeout(function(){b.eventType==fjs.model.DataManager.EV_FDP_CONFIG_ERROR?(a.fdpConfigured=!1,a.fdpErrorMessage=b.message):b.eventType==fjs.model.DataManager.EV_FDP_CONFIG&&(a.fdpConfigured=!0,a.fdpErrorMessage=b.message);if(b.eventType==fjs.model.DataManager.EV_CONNECTION_ESTABLISHED||b.eventType==fjs.model.DataManager.EV_NETWORK_PROBLEM)a.connection=b.connected,a.isConnected=a.connection&&a.loggined,a.fdpConfigured&&(a.fdpErrorMessage=b.message);l();
e.safeApply(a)},1E3)};a.$on("onLocationStatus",function(b,c){a.isLocationRegistered=c;l();e.safeApply(a)});a.showSaveCallLogDialog=function(b){0<b.mycallsclient_callLog.related.length?(a.dialogTemplate="templates/saveCallLogDialog.html",a.dialogModel=b,e.safeApply(a)):a.saveCallLog(b)};a.closeDialog=function(){a.dialogTemplate=null;a.dialogModel=null};a.saveCallLog=function(a){if(a&&a.mycallsclient_callLog){var b={action:"addCallLog",data:{}};b.data.subject=a.mycallsclient_callLog.subject;b.data.whoId=
a.mycallsclient_callLog.whoId;b.data.whatId=a.mycallsclient_callLog.whatId;b.data.note=a.mycallsclient_callLog.note;b.data.callType=a.incoming?"inbound":"outbound";b.data.duration=Math.round(((new Date).getTime()-(a.created+i.getDefault()))/1E3);b.data.date=a.mycallsclient_callLog.date;b.callback=function(a){fjs.utils.Console.error(a)};f.sendAction(b)}};a.$on("$destroy",function(){e.meModel.removeEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,e.meListener);d.removeWarningListener(fjs.controllers.CommonController.AUTHORIZATION_LISTENER,
e.authorizationWarningListener);d.removeWarningListener(fjs.controllers.CommonController.CONNECTION_LISTENER,e.connectionWarningListener)});this.meModel.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.meListener);d.addWarningListener(fjs.controllers.MainController.AUTHORIZATION_LISTENER,this.authorizationWarningListener);d.addWarningListener(fjs.controllers.MainController.CONNECTION_LISTENER,this.connectionWarningListener);l()};
fjs.controllers.MainController.CONNECTION_LISTENER="Connection";fjs.controllers.MainController.AUTHORIZATION_LISTENER="Authorization";fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL="clientsettings";fjs.controllers.MainController.IS_WARNING_SHOWN="isWarningsShown";fjs.controllers.MainController.extend(fjs.controllers.CommonController);namespace("fjs.controllers");
fjs.controllers.NewCallController=function(a,b,d){a.phone="";var c=document.getElementById("plate");c.onclick=function(){a.$apply(function(){a.closeDialpad()})};a.actionCall=function(b){d.sendAction(fjs.model.MeModel.NAME,"callTo",{phoneNumber:b});a.phone="";a.closeDialpad()};a.showDialpad=function(){a.dialogPath?a.closeDialpad():(a.dialogPath="templates/dialpad.html",c.style.display="block",e())};a.closeDialpad=function(){a.dialogPath=null;c.style.display="none"};a.$on("onDilapadKey",function(b,
c){a.phone+=c;e()});var e=function(){document.getElementById("inputPhone").focus()}};namespace("fjs.controllers");fjs.controllers.TransferDialog=function(a){a.transfer_phone="";a.dialpadPath="templates/dialpad.html";a.$on("onDilapadKey",function(b,d){a.transfer_phone+=d;document.getElementById("inputTransfer").focus()});a.transfer=function(){a.$emit("transfer",a.transfer_phone)}};namespace("fjs.controllers");
fjs.controllers.WarningsController=function(a,b,d){fjs.controllers.CommonController(this);this.me=d.getModel(fjs.model.MeModel.NAME);this.locations=d.getModel("locations");var c=this;this.completeMeListener=function(){a.name=c.me.getProperty("display_name");a.fdp_version=c.me.getProperty("fdp_version");a.my_jid=c.me.getProperty("my_jid");a.extension=c.me.getProperty("primary_extension");a.locationId=c.me.getProperty("current_location");if(c.locations.items&&c.locations.items[a.locationId]){a.location=
c.locations.items[a.locationId].shortName;var b=c.locations.items[a.locationId];b&&e(b)}c.safeApply(a)};this.locationListener=function(){if(c.locations.items&&c.locations.items[a.locationId]){var b=c.locations.items[a.locationId];a.location=b.shortName;e(b);c.safeApply(a)}};this.me.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.completeMeListener);this.locations.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.locationListener);var e=function(b){b&&
b.locationType==fjs.controllers.WarningsController.CARRIER_TYPE?(a.locationState=fjs.controllers.WarningsController.REGISTERED,a.$emit(fjs.controllers.WarningsController.ON_LOCATION_STATUS,!0)):"r"==b.location_status_deviceStatus?(a.locationState=fjs.controllers.WarningsController.REGISTERED,a.$emit(fjs.controllers.WarningsController.ON_LOCATION_STATUS,!0)):(a.locationState=fjs.controllers.WarningsController.UNREGISTERED,a.$emit(fjs.controllers.WarningsController.ON_LOCATION_STATUS,!1))};a.sendFeedback=
function(){var b;b="Jid: "+a.my_jid;b+="; Name: "+a.name;b+="; Extension: "+a.extension;b+="; License: "+a.license;b+="; FDP version: "+a.fdp_version;b=a.msg&&0!=a.msg.length?b+("; Message: "+a.msg+"."):b+";";var c={};c.description=b;c.date=(new Date).getTime();c.email="";c.taskId="-1_-1";d.sendAction(fjs.model.MeModel.NAME,"feedback",c);a.close()};a.close=function(){a.hideWarnings()};a.$on("$destroy",function(){c.me.removeEventListener(fjs.controllers.CommonController.PUSH_LISTENER,c.completeMeListener);
c.locations.removeEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,c.locationListener)})};fjs.controllers.WarningsController.extend(fjs.controllers.CommonController);fjs.controllers.WarningsController.REGISTERED="Registered";fjs.controllers.WarningsController.UNREGISTERED="Unregistered";fjs.controllers.WarningsController.CARRIER_TYPE="m";fjs.controllers.WarningsController.ON_LOCATION_STATUS="onLocationStatus";namespace("fjs.controllers");
fjs.controllers.DialpadController=function(a){a.clickDialpad=function(b){a.$emit("onDilapadKey",b)}};"use strict";var ng_app=angular.module("SFAdapter",["SFA_model","SF_API"]);ng_app.controller("NewCallController",["$scope","$element","DataManager",fjs.controllers.NewCallController]);ng_app.controller("CallsListController",["$scope","DataManager",fjs.controllers.CallsListController]);ng_app.controller("CallController",["$scope","$element","$timeout","$filter","$sce","DataManager","SFApi",fjs.controllers.CallController]);
ng_app.controller("DialpadController",["$scope",fjs.controllers.DialpadController]);ng_app.controller("TransferDialog",["$scope",fjs.controllers.TransferDialog]);ng_app.controller("WarningsController",["$scope","$element","DataManager",fjs.controllers.WarningsController]);ng_app.controller("MainController",["$scope","$element","DataManager","SFApi",fjs.controllers.MainController]);
