'use strict';var SFApi=function(){if(SFApi.__instance)return SFApi.__instance;SFApi.__instance=this};SFApi.PREFIX="Fon.";SFApi.FON_LOGIN_CLASS_NAME="FonLogin";SFApi.prototype.enableCalls=function(a){a?sforce.interaction.cti.enableClickToDial():sforce.interaction.cti.disableClickToDial()};SFApi.prototype.setPhoneApi=function(a,b){this.enableCalls(!0);sforce.interaction.cti.onClickToDial(b)};
SFApi.prototype.addCallLog=function(a,b,c,d,e,f,j,i){var h="Completed";null==b&&null==c&&(h="Not Started");var g="Subject="+encodeURIComponent(a)+"&CallType="+e+"&CallDurationInSeconds="+f+"&Status="+h+"&Type=Call&ActivityDate="+j;b&&(g+="&WhoId="+b);c&&(g+="&WhatId="+c);SFApi.prototype.getCalllogCommentField(function(a){var b="Description";a&&a.result&&(null!=a.result&&""!=a.result)&&(b=a.result);d&&(g+="&"+b+"="+encodeURIComponent(d));f&&j&&e?sforce.interaction.saveLog("Task",g,function(a){i(a)}):
fjs.utils.Console.error("Wrong arguments for adding call log.")})};SFApi.prototype.getPhoneInfo=function(a,b,c,d){sforce.interaction.searchAndGetScreenPopUrl(a,"",b,d)};SFApi.prototype.getPhoneInfoAndOpenPopup=function(a,b,c,d){sforce.interaction.searchAndScreenPop(a,"acc10="+b+"&con10="+b+"&lea8="+b,c,d)};SFApi.prototype.openUser=function(a,b){sforce.interaction.screenPop("/"+a,!0,b)};
SFApi.prototype.openCreateContactDialog=function(a){sforce.interaction.screenPop("/003/e?acc10="+a+"&con10="+a+"&lea8="+a,!0,function(){})};SFApi.prototype.setSoftphoneHeight=function(a,b){sforce.interaction.cti.setSoftphoneHeight(a,b)};SFApi.prototype.setSoftphoneWidth=function(a,b){sforce.interaction.cti.setSoftphoneWidth(a,b)};SFApi.prototype.getLoginInfo=function(a){sforce.interaction.runApex(SFApi.PREFIX+SFApi.FON_LOGIN_CLASS_NAME,"getLoginInfo",null,a)};
SFApi.prototype.getCalllogCommentField=function(a){sforce.interaction.runApex(SFApi.PREFIX+SFApi.FON_LOGIN_CLASS_NAME,"getCalllogFieldName",null,a)};namespace("fjs.sf");fjs.sf.SFSimpleProvider=function(){if(!fjs.sf.SFSimpleProvider.__instance){var a=new fjs.api.TabsSynchronizer,b=this;this.isMaster=a.isMaster;a.addEventListener("master_changed",function(){b.isMaster=a.isMaster});this.api=new SFApi;fjs.sf.SFSimpleProvider.__instance=this}return fjs.sf.SFSimpleProvider.__instance};
fjs.sf.SFSimpleProvider.prototype.sendAction=function(a){if(this.isMaster)switch(a.action){case "enableCalls":this.api.enableCalls(a.data.isReg,a.callback);break;case "addCallLog":this.api.addCallLog(a.data.subject,a.data.whoId,a.data.whatId,a.data.note,a.data.callType,a.data.duration,a.data.date,a.callback);break;case "getPhoneInfo":this.api.getPhoneInfo(a.data.phone,a.data.callType,a.data.isRinging,a.callback);break;case "getCalllogCommentField":this.api.getCalllogCommentField(a.callback)}switch(a.action){case "getLoginInfo":this.api.getLoginInfo(a.callback);
break;case "setSoftphoneHeight":this.api.setSoftphoneHeight(a.data.height,a.callback);break;case "setSoftphoneWidth":this.api.setSoftphoneWidth(a.data.width,a.callback);break;case "setPhoneApi":this.api.setPhoneApi(a.data.isPhoneReg,a.callback);break;case "openUser":this.api.openUser(a.data.id,a.callback);break;case "getPhoneInfoAndOpenPopup":this.api.getPhoneInfoAndOpenPopup(a.data.phoneSearch,a.data.phone,a.data.callType,a.callback)}};fjs.sf.SFSimpleProvider.check=function(){return!0};namespace("fjs.sf");
fjs.sf.SFApiProviderFactory=function(){this._providers={simple:fjs.sf.SFSimpleProvider}};fjs.sf.SFApiProviderFactory.prototype.getProvider=function(){return new fjs.sf.SFSimpleProvider};var sfa_model=angular.module("SF_API",[]);sfa_model.service("SFApi",fjs.sf.SFApiProviderFactory);namespace("fjs.model");fjs.model.EntryModel=function(a){this.xpid=this.xef001iver=this.xef001id=null;this.fill(a)};fjs.model.EntryModel.prototype.fill=function(a){if(a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};
namespace("fjs.model");fjs.model.FeedModel=function(a,b){fjs.EventsSource.call(this);this.feedName=a;this.items={};this.order=[];this.dataManager=b;this.listeners={start:[],push:[],"delete":[],complete:[]};this.init()};fjs.model.FeedModel.extend(fjs.EventsSource);fjs.model.FeedModel.EVENT_TYPE_START="start";fjs.model.FeedModel.EVENT_TYPE_PUSH="push";fjs.model.FeedModel.EVENT_TYPE_DELETE="delete";fjs.model.FeedModel.EVENT_TYPE_CHANGE="change";fjs.model.FeedModel.EVENT_TYPE_COMPLETE="complete";
fjs.model.FeedModel.prototype.getEntryByXpid=function(a){return this.items[a]};fjs.model.FeedModel.prototype.init=function(){var a=this;this.dataManager.addEventListener(this.feedName,function(b){a.onSyncStart();for(var c in b.changes)if(b.changes.hasOwnProperty(c)){var d=b.changes[c];if(fjs.model.FeedModel.EVENT_TYPE_CHANGE==d.type)a.onEntryChange(d);else if(fjs.model.FeedModel.EVENT_TYPE_DELETE==d.type)a.onEntryDeletion(d);else fjs.utils.Console.error("Unknown change type:",d.type)}a.onSyncComplete()})};
fjs.model.FeedModel.prototype.prepareEntry=function(){};fjs.model.FeedModel.prototype.onSyncStart=function(a){this.fireEvent(fjs.model.FeedModel.EVENT_TYPE_START,a)};fjs.model.FeedModel.prototype.onEntryDeletion=function(a){var b=this.order.indexOf(this.items[a.xpid]);-1<b&&this.order.splice(b,1);delete this.items[a.xpid];this.fireEvent(fjs.model.FeedModel.EVENT_TYPE_DELETE,a)};
fjs.model.FeedModel.prototype.onEntryChange=function(a){var b=this.items[a.xpid];b?b.fill(a.entry):(b=this.items[a.xpid]=new fjs.model.EntryModel(a.entry),this.order.push(b));this.prepareEntry(b);this.fireEvent(fjs.model.FeedModel.EVENT_TYPE_PUSH,b)};fjs.model.FeedModel.prototype.onSyncComplete=function(a){this.fireEvent(fjs.model.FeedModel.EVENT_TYPE_COMPLETE,a)};
fjs.model.FeedModel.prototype.addEventListener=function(a,b){fjs.EventsSource.prototype.addEventListener.call(this,a,b);if(a==fjs.model.FeedModel.EVENT_TYPE_PUSH)for(var c in this.items)this.items.hasOwnProperty(c)&&b({eventType:fjs.model.FeedModel.EVENT_TYPE_PUSH,xpid:c,entry:this.items[c]})};namespace("fjs.model");fjs.model.MeModel=function(a){fjs.model.FeedModel.call(this,fjs.model.MeModel.NAME,a);this.property2key={};this.propertyKey2Xpid={}};fjs.model.MeModel.extend(fjs.model.FeedModel);
fjs.model.MeModel.prototype.onEntryChange=function(a){a.entry&&(a.entry.propertyKey?(this.propertyKey2Xpid[a.xpid]=a.entry.propertyKey,this.property2key[a.entry.propertyKey]=a.entry):this.property2key[this.propertyKey2Xpid[a.xpid]]=a.entry,this.superClass.onEntryChange.call(this,a))};
fjs.model.MeModel.prototype.onEntryDeletion=function(a){var b=this.propertyKey2Xpid[a.xpid];delete this.propertyKey2Xpid[a.xpid];this.property2key[b].xpid==a.xpid&&delete this.property2key[b];this.superClass.onEntryDeletion.call(this,a)};fjs.model.MeModel.prototype.getProperty=function(a){return this.property2key[a]&&this.property2key[a].propertyValue};fjs.model.MeModel.NAME="me";namespace("fjs.model");
fjs.model.MyCallsFeedModel=function(a){fjs.model.FeedModel.call(this,"mycallsclient",a);this.htCallIdToXpid={};this.listeners.changepid=[];this.changes={};this.clientSettingsModel=this.dataManager.getModel("clientsettings")};fjs.model.MyCallsFeedModel.extend(fjs.model.FeedModel);fjs.model.MyCallsFeedModel.prototype.prepareEntry=function(a){this.htCallIdToXpid[a.htCallId]=a.xpid};
fjs.model.MyCallsFeedModel.prototype.htCallIdByXpid=function(a){for(var b in this.htCallIdToXpid)if(this.htCallIdToXpid.hasOwnProperty(b)&&this.htCallIdToXpid[b]==a)return b};fjs.model.MyCallsFeedModel.prototype.onEntryDeletion=function(a){var b=this.htCallIdByXpid(a.xpid);this.changes[b]||(this.changes[b]={});this.changes[b].delete=a};
fjs.model.MyCallsFeedModel.prototype.onEntryChange=function(a){var b=this.items[a.xpid],b=b?b.htCallId:a.entry.htCallId;this.changes[b]||(this.changes[b]={});this.changes[b].push=a};
fjs.model.MyCallsFeedModel.prototype.getPhoneInfoAndOpenPopup=function(a,b){if(7!=a.type&&0==a.state&&a.incoming&&2==b.state&&document.hasFocus()){var c={},d=this;c.action="getPhoneInfoAndOpenPopup";c.data={};c.data.phoneSearch=a.getFormattedPhone();c.data.phone=a.phone;c.data.callType="inbound";c.callback=function(){a.fillCallLogData(data,d.dataManager.getModel("clientsettings"))&&d.dataManager.sendAction("mycallsclient","push",{callLog:a.mycallsclient_callLog,xpid:a.xpid})};this.dataManager.sf.sendAction(c)}};
fjs.model.MyCallsFeedModel.prototype.onSyncComplete=function(a){for(var b in this.changes){var c,d;if(this.changes.hasOwnProperty(b))if(d=this.changes[b],d.push&&!d.delete)c=d.push,(d=this.items[c.xpid])?(this.getPhoneInfoAndOpenPopup(d,c.entry),d.fill(c.entry)):(d=this.items[c.xpid]=new fjs.model.MyCallEntryModel(c.entry),this.order.push(d)),this.prepareEntry(d),this.fireEvent("push",d),(!this.clientSettingsModel.items.openedCall||null!=this.clientSettingsModel.items.openedCall.value&&!this.items[this.clientSettingsModel.items.openedCall.value])&&
(2==d.state||0==d.state)&&this.dataManager.sendAction("clientsettings","push",{xpid:"openedCall",value:d.xpid}),fjs.utils.Console.log("!!!!push ",c.xpid,c.entry);else if(!d.push&&d.delete)c=d.delete,d=this.order.indexOf(this.items[c.xpid]),-1<d&&this.order.splice(d,1),delete this.items[c.xpid],this.fireEvent("delete",c),fjs.utils.Console.log("!!!!delete ",c.xpid);else if(d.push&&d.delete){c=d.delete;var e=d.push;d=this.items[c.xpid];this.getPhoneInfoAndOpenPopup(d,e.entry);d.fill(e.entry);delete this.items[c.xpid];
this.prepareEntry(d);this.items[e.xpid]=d;var f=this.clientSettingsModel.getEntryByXpid("openedCall");f&&f.value==c.xpid&&this.dataManager.sendAction("clientsettings","push",{xpid:"openedCall",value:e.xpid});d.oldPid=c.xpid;d.pidChanged=!0;e.eventType="changepid";this.fireEvent("changepid",d);fjs.utils.Console.log("!!!!changepid ","from:",d.oldPid,"to:",e.xpid)}}this.changes={};this.fireEvent("complete",a);fjs.utils.Console.log("!!!OnCallsSyncEnd!!!")};fjs.model.MyCallsFeedModel.NAME="mycallsclient";
namespace("fjs.model");fjs.model.MyCallEntryModel=function(a){this._who=[];this._what=[];fjs.model.EntryModel.call(this,a);a=new Date(this.created);this.mycallsclient_callLog={date:a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),subject:this.getCallSubject(),xpid:this.xpid,note:"",callType:this.incoming?"inbound":"outbound",isOpened:!0,tranferOpened:!1,whatId:null,whoId:null,related:[]}};fjs.model.MyCallEntryModel.extend(fjs.model.EntryModel);
fjs.model.MyCallEntryModel.prototype.getCallSubject=function(){var a=[],b=new Date(this.created);a.push(this.incoming?"Inbound":"Outbound");a.push("Call");a.push(function(a){var b=a.getDate().toString(),e=(a.getMonth()+1).toString(),a=a.getFullYear().toString(),b=1<b.length?b:"0"+b,e=1<e.length?e:"0"+e;return b+"/"+e+"/"+a}(b));return a.join(" ")};
fjs.model.MyCallEntryModel.prototype.getFormattedPhone=function(){if(this.phone){var a=this.phone.replace(/[^0-9]/g,"");10<a.length&&(a=a.slice(a.length-10,a.length));var b=null;4<a.length&&(b=a.split("").reverse().join(""),7<b.length&&10>=b.length&&(b=b.replace(/(\d{4})(\d{3})(\d{3}|\d{2}|\d{1})/,"$1-$2-$3")),4<b.length&&7>=b.length&&(b=b.replace(/(\d{4})(\d{3}|\d{2}|\d{1})/,"$1-$2")),b=b.split("").reverse().join(""));b&&(a+=" or "+b);return a}return null};
fjs.model.MyCallEntryModel.HOLD_CALL_TYPE=3;fjs.model.MyCallEntryModel.RING_CALL_TYPE=0;fjs.model.MyCallEntryModel.prototype.onHold=function(){return this.state==fjs.model.MyCallEntryModel.HOLD_CALL_TYPE};fjs.model.MyCallEntryModel.prototype.isRing=function(){return this.state==fjs.model.MyCallEntryModel.RING_CALL_TYPE};
fjs.model.MyCallEntryModel.prototype.getWho=function(a){for(var b=0;b<this.mycallsclient_callLog.related.length;b++){var c=this.mycallsclient_callLog.related[b];if("who"==this.getRelatedItemType(c)&&(!a||"Lead"!=c.object))return c}};fjs.model.MyCallEntryModel.prototype.getWhat=function(){for(var a=0;a<this.mycallsclient_callLog.related.length;a++){var b=this.mycallsclient_callLog.related[a];if("what"==this.getRelatedItemType(b))return b}};
fjs.model.MyCallEntryModel.prototype.findCallLogTargetById=function(a){for(var b=0;b<this.mycallsclient_callLog.related.length;b++){var c=this.mycallsclient_callLog.related[b];if(c._id==a)return c}};fjs.model.MyCallEntryModel.prototype.getRelatedItemType=function(a){return"Contact"==a.object||"Lead"==a.object?"who":"what"};
fjs.model.MyCallEntryModel.prototype.fillCallLogData=function(a,b){var c=this.mycallsclient_callLog.whatId,d=this.mycallsclient_callLog.whoId,e=!1;this.mycallsclient_callLog._notNew||(this.mycallsclient_callLog._notNew=e=!0);this.pidChanged&&(e=!0,this.pidChanged=!1);var f=b.items.phoneMap&&b.items.phoneMap.phones||{};if(a&&a.result){var j=fjs.utils.JSON.parse(a.result),i;for(i in j)if(j.hasOwnProperty(i)&&"screenPopUrl"!=i&&"CaseComment"!=j[i].object){var h=j[i];h._id=i;"Case"==h.object&&(h.Name=
h.CaseNumber);var g=this.findCallLogTargetById(i);g?g.Name!=h.Name&&(g.Name=h.Name,e=!0):(g=h,this.mycallsclient_callLog.related.push(g),e=!0);g.new=!0}}j=this.mycallsclient_callLog.related.slice(0);for(i=0;i<j.length;i++)if(h=j[i],h.new)h.new=!1;else{var k=this.mycallsclient_callLog.related.indexOf(h);-1<k&&(this.mycallsclient_callLog.related.splice(k,1),this.mycallsclient_callLog.pervWhatId==h._id&&(this.mycallsclient_callLog.pervWhatId=null),e=!0)}fjs.model.filter.SortRelatedFields()(this.mycallsclient_callLog.related);
(f=f[this.phone])&&(g=this.findCallLogTargetById(f.id))?"who"==this.getRelatedItemType(g)?(this.mycallsclient_callLog.whoId=f.id,"Lead"==g.object&&(this.mycallsclient_callLog.whatId=null)):(g=this.getWho(!0),this.mycallsclient_callLog.whoId=g&&g._id,this.mycallsclient_callLog.whatId=f.id):(g=this.findCallLogTargetById(this.mycallsclient_callLog.whoId),this.findCallLogTargetById(this.mycallsclient_callLog.whatId),g||(g=this.getWho(),this.mycallsclient_callLog.whoId=g&&g._id));f&&b.deletePhone(this.phone);
return e||c!=this.mycallsclient_callLog.whatId||d!=this.mycallsclient_callLog.whoId};fjs.model.MyCallEntryModel.prototype.fill=function(a,b){b=b||this;if(a)for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if("object"!=typeof d||null==d){if("note"!=c||!this._blockChangeNote)b[c]=d}else Array.isArray(d)?b[c]=[]:b[c]||(b[c]={}),this.fill(d,b[c])}};
fjs.model.MyCallEntryModel.prototype.showRelated=function(){var a=this.findCallLogTargetById(this.mycallsclient_callLog.whoId);return this.getWhat()&&(!a||"Lead"!=a.object)};namespace("fjs.model");fjs.model.ClientSettingsFeedModel=function(a){fjs.model.FeedModel.call(this,"clientsettings",a)};fjs.model.ClientSettingsFeedModel.extend(fjs.model.FeedModel);
fjs.model.ClientSettingsFeedModel.prototype.savePhone=function(a,b){if(this.items.phoneMap)this.items.phoneMap.phones[a]=b,this.dataManager.sendAction("clientsettings","push",this.items.phoneMap);else{var c={xpid:"phoneMap",phones:{}};c.phones[a]=b;this.dataManager.sendAction("clientsettings","push",c)}};fjs.model.ClientSettingsFeedModel.prototype.deletePhone=function(a){this.items.phoneMap&&(delete this.items.phoneMap.phones[a],this.dataManager.sendAction("clientsettings","push",this.items.phoneMap))};
namespace("fjs.model");fjs.model.ClientCallLogFeedModel=function(a){fjs.model.FeedModel.call(this,"clientcalllog",a)};fjs.model.ClientCallLogFeedModel.extend(fjs.model.FeedModel);namespace("fjs.model.filter");fjs.model.filter.What=function(){return function(a){return a.filter(function(a){return"Contact"!=a.object&&"Lead"!=a.object})}};namespace("fjs.model.filter");fjs.model.filter.Who=function(){return function(a){return a.filter(function(a){return"Contact"==a.object||"Lead"==a.object})}};namespace("fjs.model.filter");
fjs.model.filter.SortRelatedFields=function(){return function(a){a.sort(function(a,b){return a.object>b.object?1:a.object<b.object?-1:a.Name.toLowerCase()>b.Name.toLowerCase()?1:a.Name.toLowerCase()<b.Name.toLowerCase()?-1:0});var b=null,c=null,d=0;a.forEach(function(a){b!=a.object?(d=0,b=a.object,c=a):a.title="";d++;c.title=b+" ("+d+")"})}};namespace("fjs.model.filter");fjs.model.filter.HasCallInfoFilter=function(){return function(a){return a.filter(function(a){return!!a.htCallId})}};namespace("fjs.model.filter");
fjs.model.filter.CallLogSort=function(){return function(a){return a.sort(function(a,c){return c.ended-a.ended})}};namespace("fjs.model");
fjs.model.DataManager=function(a){fjs.EventsSource.call(this);this.feeds={};this.node=this.ticket=null;this.phoneMap={};this.state=-1;this.suspendFeeds=[];this.suspendActions=[];this.warningListeners={};this.loginInfo={};this.sf=a.getProvider();var b=this,c=new fjs.api.FDPProviderFactory;this.authErrorCount=0;this.MAX_AUTH_ERROR_COUNT=3;this.tabSynchronizer=new fjs.api.TabsSynchronizer;this.checkLoginTimeoutId=null;var d=function(a){var a=a&&a.result&&JSON.parse(a.result),c=a.number;if(c){var d={};
d.id=a.objectId;d.type=a.object;b.getModel("clientsettings").savePhone(c,d);b.sendAction(fjs.model.MeModel.NAME,"callTo",{phoneNumber:c})}};this.checkDevice=function(){var a={action:"setPhoneApi",data:{}};a.data.isReg=!0;a.callback=d;b.sf.sendAction(a)};this.checkDevice();var e=function(){null!=b.checkLoginTimeoutId&&clearInterval(b.checkLoginTimeoutId);b.checkLoginTimeoutId=setInterval(function(){b._getAuthInfo(function(a){a&&(b._authInfoChanged(a)&&b.dataProvider&&b.state)&&(fjs.utils.Cookies.remove(fjs.model.DataManager.AUTH_COOKIE_NAME),
b.dataProvider.sendMessage({action:"SFLogin",data:a}))})},9E5)};this.tabSynchronizer.isMaster&&e();this.tabSynchronizer.addEventListener("master_changed",function(){b.tabSynchronizer.isMaster?e():clearInterval(b.checkLoginTimeoutId)});this._getAuthInfo(function(a){a&&(b._authInfoChanged(a)||!b._getAccessInfo()?(fjs.utils.Cookies.remove(fjs.model.DataManager.AUTH_COOKIE_NAME),b.dataProvider=c.getProvider(null,null,function(){b.dataProvider.sendMessage({action:"SFLogin",data:a});b.state=1})):b.dataProvider=
c.getProvider(b.ticket,b.node,function(){b.state=1;if(0<b.suspendFeeds.length){for(var a=0;a<b.suspendFeeds.length;a++)b.dataProvider.addSyncForFeed(b.suspendFeeds[a]);b.suspendFeeds=[]}if(0<b.suspendActions.length){for(a=0;a<b.suspendActions.length;a++)b.dataProvider.sendMessage(b.suspendActions[a]);b.suspendActions=[]}}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_SYNC,function(a){a=a.data||a;b.fireEvent(a.feed,a)}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_AUTH_ERROR,
function(a){if(b.authErrorCount<b.MAX_AUTH_ERROR_COUNT){b._getAuthInfo(function(a){b.dataProvider.sendMessage({action:"SFLogin",data:a})});b.authErrorCount++}else b.fireWarningEvent(fjs.model.DataManager.AUTHORIZATION_STATE,a)}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_REQUEST_ERROR,function(a){fjs.utils.Console.error(a)}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_NETWORK_PROBLEM,function(a){fjs.utils.Console.error(a);b.fireWarningEvent(fjs.model.DataManager.CONNECTION_STATE,
{eventType:fjs.model.DataManager.EV_NETWORK_PROBLEM,connected:false,message:"Network problem"})}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_CONNECTION_ESTABLISHED,function(a){fjs.utils.Console.info(a);b.fireWarningEvent(fjs.model.DataManager.CONNECTION_STATE,{eventType:fjs.model.DataManager.EV_CONNECTION_ESTABLISHED,connected:true,message:""})}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_NODE,function(a){fjs.utils.Cookies.set(fjs.model.DataManager.NODE_COOKIE_NAME,b.node=
a.data.nodeId)}),b.dataProvider.addEventListener(fjs.model.DataManager.EV_TICKET,function(a){fjs.utils.Cookies.set(fjs.model.DataManager.AUTH_COOKIE_NAME,b.ticket=a.data.ticket);b.fireWarningEvent(fjs.model.DataManager.AUTHORIZATION_STATE,a);if(b.suspendFeeds.length>0){for(a=0;a<b.suspendFeeds.length;a++)b.dataProvider.addSyncForFeed(b.suspendFeeds[a]);b.suspendFeeds=[]}if(b.suspendActions.length>0){for(a=0;a<b.suspendActions.length;a++)b.dataProvider.sendMessage(b.suspendActions[a]);b.suspendActions=
[]}}))})};fjs.model.DataManager.extend(fjs.EventsSource);fjs.model.DataManager.AUTHORIZATION_STATE="Authorization";fjs.model.DataManager.CONNECTION_STATE="Connection";fjs.model.DataManager.EV_SYNC="sync";fjs.model.DataManager.EV_AUTH_ERROR="authError";fjs.model.DataManager.EV_REQUEST_ERROR="requestError";fjs.model.DataManager.EV_NETWORK_PROBLEM="networkProblem";fjs.model.DataManager.EV_CONNECTION_ESTABLISHED="connectionEstablished";fjs.model.DataManager.EV_TICKET="ticket";
fjs.model.DataManager.EV_NODE="node";fjs.model.DataManager.EV_FDP_CONFIG_ERROR="fdpConfigError";fjs.model.DataManager.EV_FDP_CONFIG="fdpConfig";fjs.model.DataManager.AUTH_COOKIE_NAME="SF_Authorization";fjs.model.DataManager.NODE_COOKIE_NAME="SF_Node";fjs.model.DataManager.CLIENT_ID_COOKIE_NAME="SF_Client_id";fjs.model.DataManager.SERVER_URL_COOKIE_NAME="SF_ServerUrl";fjs.model.DataManager.HUD_LOGIN_COOKIE_NAME="SF_Login";fjs.model.DataManager.HUD_EMAIL_COOKIE_NAME="SF_Email";
fjs.model.DataManager.ADM_LOGIN_COOKIE_NAME="SF_ADM_Login";
fjs.model.DataManager.prototype.getModel=function(a){if(!this.feeds[a])switch(a){case fjs.model.MeModel.NAME:this.feeds[a]=new fjs.model.MeModel(this);break;case "mycallsclient":this.feeds[a]=new fjs.model.MyCallsFeedModel(this);break;case "clientsettings":this.feeds[a]=new fjs.model.ClientSettingsFeedModel(this);break;case "clientcalllog":this.feeds[a]=new fjs.model.ClientCallLogFeedModel(this);break;default:this.feeds[a]=new fjs.model.FeedModel(a,this)}return this.feeds[a]};
fjs.model.DataManager.prototype.sendAction=function(a,b,c){a={action:"fdp_action",data:{feedName:a,actionName:b,params:c}};1==this.state?this.dataProvider.sendMessage(a):this.suspendActions.push(a)};
fjs.model.DataManager.prototype._authInfoChanged=function(a){var b=!1;if((fjs.utils.Cookies.get(fjs.model.DataManager.HUD_LOGIN_COOKIE_NAME)||this.loginInfo.hud)!=a.hud+"")this.tabSynchronizer.isMaster&&fjs.utils.Cookies.set(fjs.model.DataManager.HUD_LOGIN_COOKIE_NAME,a.hud),this.loginInfo.hud=a.hud+"",b=!0;if((fjs.utils.Cookies.get(fjs.model.DataManager.ADM_LOGIN_COOKIE_NAME)||this.loginInfo.login)!=a.login+"")this.tabSynchronizer.isMaster&&fjs.utils.Cookies.set(fjs.model.DataManager.ADM_LOGIN_COOKIE_NAME,
a.login+""),this.loginInfo.login=a.login+"",b=!0;if((fjs.utils.Cookies.get(fjs.model.DataManager.HUD_EMAIL_COOKIE_NAME)||this.loginInfo.email)!=a.email+"")this.tabSynchronizer.isMaster&&fjs.utils.Cookies.set(fjs.model.DataManager.HUD_EMAIL_COOKIE_NAME,a.email+""),this.loginInfo.email=a.email+"",b=!0;return b};
fjs.model.DataManager.prototype._getAccessInfo=function(){this.ticket=fjs.utils.Cookies.get(fjs.model.DataManager.AUTH_COOKIE_NAME);this.node=fjs.utils.Cookies.get(fjs.model.DataManager.NODE_COOKIE_NAME);return this.ticket};
fjs.model.DataManager.prototype._getAuthInfo=function(a){var b={},c=this;b.action="getLoginInfo";b.callback=function(b){var e=null,f=null;b&&(b.error?(fjs.utils.Console.error("SF response error",b.error),a(null)):f=JSON.parse(b.result));f&&((e={login:f.admLogin,token:f.admPassword,email:f.email},f.hudLogin&&(e.hud=f.hudLogin),f.serverUrl)?(fjs.fdp.CONFIG.SERVER.serverURL=f.serverUrl,c.fireWarningEvent(fjs.model.DataManager.CONNECTION_STATE,{eventType:fjs.model.DataManager.EV_FDP_CONFIG,message:""})):
c.fireWarningEvent(fjs.model.DataManager.CONNECTION_STATE,{eventType:fjs.model.DataManager.EV_FDP_CONFIG_ERROR,message:"Server URL was not specified"}));a(e)};this.sf.sendAction(b)};fjs.model.DataManager.prototype.addEventListener=function(a,b){if(!this.listeners[a]||0==this.listeners[a].length)1!=this.state&&0>this.suspendFeeds.indexOf(a)?this.suspendFeeds.push(a):this.dataProvider.addSyncForFeed(a);this.superClass.addEventListener.call(this,a,b)};
fjs.model.DataManager.prototype.addWarningListener=function(a,b){if(this.warningListeners[a])this.warningListeners[a].push(b);else{var c=[];c.push(b);this.warningListeners[a]=c}};fjs.model.DataManager.prototype.removeWarningListener=function(a,b){var c=this.warningListeners[a].indexOf(b);-1<c&&this.warningListeners[a].splice(c,1)};fjs.model.DataManager.prototype.fireWarningEvent=function(a,b){var c=this.warningListeners[a];if(c)for(var d=0;d<c.length;d++)c[d](b)};
sfa_model=angular.module("SFA_model",["SF_API"]);sfa_model.service("DataManager",["SFApi",fjs.model.DataManager]);sfa_model.filter("WhoFilter",fjs.model.filter.Who);sfa_model.filter("WhatFilter",fjs.model.filter.What);sfa_model.filter("SortRelatedFields",fjs.model.filter.SortRelatedFields);sfa_model.filter("HasCallInfoFilter",fjs.model.filter.HasCallInfoFilter);sfa_model.filter("CallLogSort",fjs.model.filter.CallLogSort);namespace("fjs.controllers");fjs.controllers.CommonController=function(){};
fjs.controllers.CommonController.prototype.safeApply=function(a,b){var c=a.$root.$$phase;"$apply"==c||"$digest"==c?b&&"function"===typeof b&&b():a.$apply(b)};fjs.controllers.CommonController.COMPLETE_LISTENER="complete";fjs.controllers.CommonController.PUSH_LISTENER="push";fjs.controllers.CommonController.DELETE_LISTENER="delete";namespace("fjs.controllers");
fjs.controllers.CallController=function(a,b,c,d,e,f,j){function i(b){if((m=a.call.phone)&&(!a.call.mycallsclient_callLog._notNew||b)&&a.call.type!=fjs.controllers.CallController.SYSTEM_CALL_TYPE){var c={action:"getPhoneInfo",data:{}};c.data.phone=a.call.getFormattedPhone();c.data.callType=a.call.incoming?"inbound":"outbound";c.data.isRinging=0==a.call.state;c.callback=function(c){a.call.fillCallLogData(c,s)&&(h(),p&&p.safeApply(a));b&&b(c)};q.sendAction(c)}}function h(){null!=o&&clearTimeout(o);o=
setTimeout(function(){f.sendAction("mycallsclient","push",{callLog:a.call.mycallsclient_callLog,xpid:a.call.xpid})},fjs.controllers.CallController.CALL_LOG_CHANGE_DELAY_IN_SEC)}function g(){a.call.mycallsclient_callLog.isOpened=!0;a.call.mycallsclient_callLog.tranferOpened=!1;h()}fjs.controllers.CommonController(this);var k=null,l=new fjs.utils.TimeSync,m=null,p=this,o=null,q=j.getProvider(),s=f.getModel("clientsettings"),t=f.getModel("me"),u=f.getModel("locations");a.getTriangle=function(){return e.trustAsHtml(a.call.mycallsclient_callLog.isOpened?
fjs.controllers.CallController.OPENED_TRIANGLE:fjs.controllers.CallController.CLOSED_TRIANGLE)};a.isAutoAnswer=function(){var b=t.getProperty("current_location"),b=u.getEntryByXpid(b);return a.call.incoming&&b&&b.location_status_autoAnswer};var r=function(){var b=(new Date).getTime()-l.getDefault()+6E4*(new Date(1)).getTimezoneOffset(),f=b-a.call.created,b=b-a.call.holdStart;a.call.duration=d("date")(new Date(f),"HH:mm:ss ");a.call.onHold()&&(a.call.holdDuration=d("date")(new Date(b),"HH:mm:ss "));
k=c(r,fjs.controllers.CallController.CALL_DURATION_DELAY_IN_SEC)};r();var n=null;a.noteKeyPress=function(){a.call._blockChangeNote=!0;null!=n&&(clearTimeout(n),n=null);n=setTimeout(function(){delete a.call._blockChangeNote;n=null},1E3)};a.showAddButton=function(){return 0==a.call.mycallsclient_callLog.related.length&&a.call.type!=fjs.controllers.CallController.SYSTEM_CALL_TYPE};a.whoChange=function(){var b=a.call.findCallLogTargetById(a.call.mycallsclient_callLog.whoId);b&&"Lead"==b.object?(a.call.mycallsclient_callLog.pervWhatId=
a.call.mycallsclient_callLog.whatId,a.call.mycallsclient_callLog.whatId=null):null==a.call.mycallsclient_callLog.whatId&&a.call.mycallsclient_callLog.pervWhatId&&(a.call.mycallsclient_callLog.whatId=a.call.mycallsclient_callLog.pervWhatId);h()};a.whatChange=function(){h()};a.noteChange=function(){h()};a.$watch("call.phone",function(b,c){b!=c&&(a.call.mycallsclient_callLog._notNew=!1);i()});a.hold=function(){f.sendAction(fjs.model.MyCallsFeedModel.NAME,"transferToHold",{mycallId:a.call.xpid});return!1};
a.accept=function(){f.sendAction(fjs.model.MyCallsFeedModel.NAME,"answer",{mycallId:a.call.xpid});return!1};a.transfer=function(){a.call.mycallsclient_callLog.tranferOpened?(a.call.mycallsclient_callLog.tranferOpened=!1,a.call.mycallsclient_callLog.isOpened=!0):(a.call.mycallsclient_callLog.tranferOpened=!0,a.call.mycallsclient_callLog.isOpened=!1);h()};a.end=function(){f.sendAction(fjs.model.MyCallsFeedModel.NAME,"hangup",{mycallId:a.call.xpid});return!1};a.unhold=function(){f.sendAction(fjs.model.MyCallsFeedModel.NAME,
"transferFromHold",{mycallId:a.call.xpid});return!1};a.toggleCallLog=function(){a.call.mycallsclient_callLog.isOpened?(a.call.mycallsclient_callLog.isOpened=!1,h()):g()};a.createContact=function(){(new SFApi).openCreateContactDialog(a.call.phone)};a.openSFLink=function(a){var b={action:"openUser",data:{}};b.data.id=a;q.sendAction(b)};a.closeTransferDialog=function(){g()};a.$on("transfer",function(b,c){c&&f.sendAction(fjs.model.MyCallsFeedModel.NAME,"transferTo",{mycallId:a.call.xpid,toNumber:c});
g()});a.callLogAvailable=function(){return!0};a.$on("$destroy",function(){k&&c.cancel(k);i(function(){f.sendAction("clientcalllog","push",{callLog:a.call.mycallsclient_callLog,incoming:a.call.incoming,created:a.call.created,ended:Date.now(),xpid:a.call.xpid})});p=null;clearTimeout(o)})};fjs.controllers.CallController.extend(fjs.controllers.CommonController);fjs.controllers.CallController.CONFERENCE_CALL_TYPE=0;fjs.controllers.CallController.SYSTEM_CALL_TYPE=7;
fjs.controllers.CallController.QUEUE_CALL_TYPE=3;fjs.controllers.CallController.EXTERNAL_CALL=5;fjs.controllers.CallController.HOLD_CALL_TYPE=3;fjs.controllers.CallController.RING_CALL_TYPE=0;fjs.controllers.CallController.TALCKING_CALL_TYPE=2;fjs.controllers.CallController.OPENED_TRIANGLE="&#9660;";fjs.controllers.CallController.CLOSED_TRIANGLE="&#9658;";fjs.controllers.CallController.SORT_FIELD_NAME="Name";fjs.controllers.CallController.CALL_GET_INFO_DELAY_IN_SEC=3E3;
fjs.controllers.CallController.CALL_DURATION_DELAY_IN_SEC=1E3;fjs.controllers.CallController.CALL_LOG_CHANGE_DELAY_IN_SEC=500;namespace("fjs.controllers");
fjs.controllers.CallsListController=function(a,b){this.callsFeedModel=b.getModel("mycallsclient");var c=this;fjs.controllers.CommonController.call(this,a);var d=b.getModel("clientsettings");a.calls=this.callsFeedModel.order;a.selectedCallId=d.items.openedCall&&d.items.openedCall.value;a.selectCall=function(c){a.selectedCallId=a.selectedCallId!=c?c:null;b.sendAction("clientsettings","push",{xpid:"openedCall",value:a.selectedCallId})};this.clientSettingsListener=function(){a.selectedCallId=d.items.openedCall&&
d.items.openedCall.value;c.safeApply(a)};this.completeCallsListener=function(){c.safeApply(a)};d.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.clientSettingsListener);this.callsFeedModel.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.completeCallsListener)};fjs.controllers.CallsListController.extend(fjs.controllers.CommonController);fjs.controllers.CallsListController.SELECTED_CALL_ID="selected_call_id";
fjs.controllers.CallsListController.SELECTED_CALL_ID_MODE="selected_call_id_mode";namespace("fjs.controllers");fjs.controllers.CallLogsController=function(a,b){this.callLogsFeedModel=b.getModel("clientcalllog");var c=this;fjs.controllers.CommonController.call(this,a);a.logs=this.callLogsFeedModel.order;this.completeCallLogsListener=function(){c.safeApply(a)};this.callLogsFeedModel.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.completeCallLogsListener)};fjs.controllers.CallLogsController.extend(fjs.controllers.CommonController);
namespace("fjs.controllers");
fjs.controllers.CallLogDialogController=function(a,b,c,d,e,f,j){function i(){null!=h&&clearTimeout(h);h=setTimeout(function(){f.sendAction("clientcalllog","push",{callLog:a.log.callLog,xpid:a.log.xpid})},fjs.controllers.CallController.CALL_LOG_CHANGE_DELAY_IN_SEC)}fjs.controllers.CommonController(this);var h=null,g=null,k=new fjs.utils.TimeSync,l=j.getProvider(),m=function(b){for(var c=0;c<a.log.callLog.related.length;c++){var d=a.log.callLog.related[c];if(d._id==b)return d}};a.noteKeyPress=function(){a._blockChangeNote=
!0;null!=g&&(clearTimeout(g),g=null);g=setTimeout(function(){delete a._blockChangeNote;g=null},1E3)};a.whoChange=function(){var b=m(a.log.callLog.whoId);b&&"Lead"==b.object?(a.log.callLog.pervWhatId=a.log.callLog.whatId,a.log.callLog.whatId=null):null==a.log.callLog.whatId&&a.log.callLog.pervWhatId&&(a.log.callLog.whatId=a.log.callLog.pervWhatId);i()};a.whatChange=function(){i()};a.getRelatedItemType=function(a){return"Contact"==a.object||"Lead"==a.object?"who":"what"};a.getWho=function(b){for(var c=
0;c<a.log.callLog.related.length;c++){var d=a.log.callLog.related[c];if("who"==a.getRelatedItemType(d)&&(!b||"Lead"!=d.object))return d}};a.getWhat=function(){for(var b=0;b<a.log.callLog.related.length;b++){var c=a.log.callLog.related[b];if("what"==a.getRelatedItemType(c))return c}};a.showRelated=function(){var b=m(a.log.callLog.whoId);return a.getWhat()&&(!b||"Lead"!=b.object)};a.noteChange=function(){i()};a.saveCallLog=function(){if(a.log.callLog){var b={action:"addCallLog",data:{}};b.data.subject=
a.log.callLog.subject;b.data.whoId=a.log.callLog.whoId;b.data.whatId=a.log.callLog.whatId;b.data.note=a.log.callLog.note;b.data.callType=a.log.incoming?"inbound":"outbound";b.data.duration=Math.round(((new Date).getTime()-(a.log.created+k.getDefault()))/1E3);b.data.date=a.log.callLog.date;b.callback=function(a){fjs.utils.Console.error(a)};l.sendAction(b)}a.closeDialog()};a.closeDialog=function(){f.sendAction("clientcalllog","delete",{callLog:a.log.callLog,xpid:a.log.xpid})}};fjs.controllers.CallLogDialogController.extend(fjs.controllers.CommonController);
namespace("fjs.controllers");
fjs.controllers.MainController=function(a,b,c,d){fjs.controllers.CommonController(this);var e=this,f=d.getProvider(),j=!1,i=null;this.clientSettingsModel=c.getModel(fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL);this.clientSettingsModel.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,function(){e.clientSettingsModel.items[fjs.controllers.MainController.IS_WARNING_SHOWN]&&(a.isWarningsShown=e.clientSettingsModel.items[fjs.controllers.MainController.IS_WARNING_SHOWN].value,e.safeApply(a))});
this.meModel=c.getModel(fjs.model.MeModel.NAME);this.SOFTPHONE_HEIGHT=this.SOFTPHONE_WIDTH=200;this.FRAME_RESIZE_NAME="resizeFrame";a.isConnected=!0;a.warningsTemplatePath="templates/warnings.html";a.isWarningsShown=!1;a.loggined=!0;a.connection=!0;a.phone=!0;a.isLocationRegistered=!0;a.fdpConfigured=!0;a.fdpErrorMessage="";a.dialogTemplate=null;a.dialogModel=null;var h=function(){var a=fjs.utils.Browser;if(g.clientHeight!=k&&(a.isIE()||a.isSafari()))b[0].style.visibility="hidden";null!=l&&(clearTimeout(l),
l=null);l=setTimeout(function(){var c=g.clientHeight;if(c!=k){var d={action:"setSoftphoneHeight",data:{}};d.data.height=g.clientHeight;d.callback=function(){l=null};f.sendAction(d)}if(a.isIE()||a.isSafari())b[0].style.visibility="visible";k=c},100)},d={action:"setSoftphoneHeight",data:{}};d.data.height=e.SOFTPHONE_HEIGHT;f.sendAction(d);d={action:"setSoftphoneWidth",data:{}};d.data.width=e.SOFTPHONE_WIDTH;f.sendAction(d);var g=document.getElementById(e.FRAME_RESIZE_NAME),k=g.clientHeight,l=null;document.body.onresize=
function(){h()};setTimeout(function(){frame.onresize=function(){h()}},200);a.showBrowserWarning=function(){if(null===i){var a=!0;if(fjs.utils.Browser.isSafari())try{window.openDatabase("test","","test",1024)}catch(b){a=!1}i=!fjs.utils.Cookies.check()||!fjs.utils.LocalStorage.check()||!a}return i&&!j};a.getBrowserWarningLink=function(){return"http://www.fonality.com/crmlink/"+fjs.utils.Browser.getBrowserName()};a.getBrowserWarningMessage=function(){return"Click here for "+fjs.utils.Browser.getBrowserName()+
" instructions."};a.closeBrowserWarning=function(){j=!0};a.showWarnings=function(){a.isWarningsShown=!0;e.safeApply(a);c.sendAction(fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL,"push",{xpid:fjs.controllers.MainController.IS_WARNING_SHOWN,value:a.isWarningsShown})};a.showLoadingPanel=function(){return!a.name&&!a.isWarningsShown&&a.loggined&&a.connection&&a.fdpConfigured};a.hideWarnings=function(){a.isWarningsShown=!1;e.safeApply(a);c.sendAction(fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL,
"push",{xpid:fjs.controllers.MainController.IS_WARNING_SHOWN,value:a.isWarningsShown})};a.toggleWarnings=function(){a.isWarningsShown?a.hideWarnings():a.showWarnings()};var m=function(){a.isWarningsButtonShown=!a.loggined||!a.connection||!a.isLocationRegistered||!a.fdpConfigured;a.loggined&&(a.connection&&a.isLocationRegistered&&a.fdpConfigured)&&(a.isWarningsShown=!1,c.sendAction(fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL,"push",{xpid:fjs.controllers.MainController.IS_WARNING_SHOWN,
value:a.isWarningsShown}));e.safeApply(a)};this.meListener=function(){var b=e.meModel.getProperty("display_name");a.name=b?"User: "+b:"";b=e.meModel.getProperty("primary_extension");a.extension=b?"Extension: x"+b:"";e.safeApply(a)};this.authorizationWarningListener=function(b){b.eventType==fjs.model.DataManager.EV_TICKET?(a.loggined=!0,a.authErrorMessage=""):b.eventType==fjs.model.DataManager.EV_AUTH_ERROR&&(a.loggined=!1,a.authErrorMessage=b.message);m();a.isConnected=a.connection&&a.loggined;e.safeApply(a)};
this.connectionWarningListener=function(b){setTimeout(function(){b.eventType==fjs.model.DataManager.EV_FDP_CONFIG_ERROR?(a.fdpConfigured=!1,a.fdpErrorMessage=b.message):b.eventType==fjs.model.DataManager.EV_FDP_CONFIG&&(a.fdpConfigured=!0,a.fdpErrorMessage=b.message);if(b.eventType==fjs.model.DataManager.EV_CONNECTION_ESTABLISHED||b.eventType==fjs.model.DataManager.EV_NETWORK_PROBLEM)a.connection=b.connected,a.isConnected=a.connection&&a.loggined,a.fdpConfigured&&(a.fdpErrorMessage=b.message);m();
e.safeApply(a)},1E3)};a.$on("onLocationStatus",function(b,c){a.isLocationRegistered=c;m();e.safeApply(a)});a.$on("$destroy",function(){e.meModel.removeEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,e.meListener);c.removeWarningListener(fjs.controllers.CommonController.AUTHORIZATION_LISTENER,e.authorizationWarningListener);c.removeWarningListener(fjs.controllers.CommonController.CONNECTION_LISTENER,e.connectionWarningListener)});this.meModel.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,
this.meListener);c.addWarningListener(fjs.controllers.MainController.AUTHORIZATION_LISTENER,this.authorizationWarningListener);c.addWarningListener(fjs.controllers.MainController.CONNECTION_LISTENER,this.connectionWarningListener);m()};fjs.controllers.MainController.CONNECTION_LISTENER="Connection";fjs.controllers.MainController.AUTHORIZATION_LISTENER="Authorization";fjs.controllers.MainController.CLIENT_SETTINGS_FEED_MODEL="clientsettings";fjs.controllers.MainController.IS_WARNING_SHOWN="isWarningsShown";
fjs.controllers.MainController.extend(fjs.controllers.CommonController);namespace("fjs.controllers");
fjs.controllers.NewCallController=function(a,b,c){a.phone="";var d=document.getElementById("plate");d.onclick=function(){a.$apply(function(){a.closeDialpad()})};a.actionCall=function(b){c.sendAction(fjs.model.MeModel.NAME,"callTo",{phoneNumber:b});a.phone="";a.closeDialpad()};a.showDialpad=function(){a.dialogPath?a.closeDialpad():(a.dialogPath="templates/dialpad.html",d.style.display="block",e())};a.closeDialpad=function(){a.dialogPath=null;d.style.display="none"};a.$on("onDilapadKey",function(b,
c){a.phone+=c;e()});var e=function(){document.getElementById("inputPhone").focus()}};namespace("fjs.controllers");fjs.controllers.TransferDialog=function(a){a.transfer_phone="";a.dialpadPath="templates/dialpad.html";a.$on("onDilapadKey",function(b,c){a.transfer_phone+=c;document.getElementById("inputTransfer").focus()});a.transfer=function(){a.$emit("transfer",a.transfer_phone)}};namespace("fjs.controllers");
fjs.controllers.WarningsController=function(a,b,c){fjs.controllers.CommonController(this);this.me=c.getModel(fjs.model.MeModel.NAME);this.locations=c.getModel("locations");var d=this;this.completeMeListener=function(){a.name=d.me.getProperty("display_name");a.fdp_version=d.me.getProperty("fdp_version");a.my_jid=d.me.getProperty("my_jid");a.extension=d.me.getProperty("primary_extension");a.locationId=d.me.getProperty("current_location");if(d.locations.items&&d.locations.items[a.locationId]){a.location=
d.locations.items[a.locationId].shortName;var b=d.locations.items[a.locationId];b&&e(b)}d.safeApply(a)};this.locationListener=function(){if(d.locations.items&&d.locations.items[a.locationId]){var b=d.locations.items[a.locationId];a.location=b.shortName;e(b);d.safeApply(a)}};this.me.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.completeMeListener);this.locations.addEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,this.locationListener);var e=function(b){b&&
b.locationType==fjs.controllers.WarningsController.CARRIER_TYPE?(a.locationState=fjs.controllers.WarningsController.REGISTERED,a.$emit(fjs.controllers.WarningsController.ON_LOCATION_STATUS,!0)):"r"==b.location_status_deviceStatus?(a.locationState=fjs.controllers.WarningsController.REGISTERED,a.$emit(fjs.controllers.WarningsController.ON_LOCATION_STATUS,!0)):(a.locationState=fjs.controllers.WarningsController.UNREGISTERED,a.$emit(fjs.controllers.WarningsController.ON_LOCATION_STATUS,!1))};a.sendFeedback=
function(){var b;b="Jid: "+a.my_jid;b+="; Name: "+a.name;b+="; Extension: "+a.extension;b+="; License: "+a.license;b+="; FDP version: "+a.fdp_version;b=a.msg&&0!=a.msg.length?b+("; Message: "+a.msg+"."):b+";";var d={};d.description=b;d.date=(new Date).getTime();d.email="";d.taskId="-1_-1";c.sendAction(fjs.model.MeModel.NAME,"feedback",d);a.close()};a.close=function(){a.hideWarnings()};a.$on("$destroy",function(){d.me.removeEventListener(fjs.controllers.CommonController.PUSH_LISTENER,d.completeMeListener);
d.locations.removeEventListener(fjs.controllers.CommonController.COMPLETE_LISTENER,d.locationListener)})};fjs.controllers.WarningsController.extend(fjs.controllers.CommonController);fjs.controllers.WarningsController.REGISTERED="Registered";fjs.controllers.WarningsController.UNREGISTERED="Unregistered";fjs.controllers.WarningsController.CARRIER_TYPE="m";fjs.controllers.WarningsController.ON_LOCATION_STATUS="onLocationStatus";namespace("fjs.controllers");
fjs.controllers.DialpadController=function(a){a.clickDialpad=function(b){a.$emit("onDilapadKey",b)}};"use strict";var ng_app=angular.module("SFAdapter",["SFA_model","SF_API"]);ng_app.controller("NewCallController",["$scope","$element","DataManager",fjs.controllers.NewCallController]);ng_app.controller("CallsListController",["$scope","DataManager",fjs.controllers.CallsListController]);ng_app.controller("CallLogsController",["$scope","DataManager",fjs.controllers.CallLogsController]);
ng_app.controller("CallController",["$scope","$element","$timeout","$filter","$sce","DataManager","SFApi",fjs.controllers.CallController]);ng_app.controller("CallLogDialogController",["$scope","$element","$timeout","$filter","$sce","DataManager","SFApi",fjs.controllers.CallLogDialogController]);ng_app.controller("DialpadController",["$scope",fjs.controllers.DialpadController]);ng_app.controller("TransferDialog",["$scope",fjs.controllers.TransferDialog]);
ng_app.controller("WarningsController",["$scope","$element","DataManager",fjs.controllers.WarningsController]);ng_app.controller("MainController",["$scope","$element","DataManager","SFApi",fjs.controllers.MainController]);
