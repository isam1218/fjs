<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">

    <title>SyncManager test</title>
    <style>
        #syncLog, #errorsLog, #nodeLog {
            width:30%;
            border:1px solid black;
            margin:2px;
            display:inline-block;
            overflow: auto;
            height: 500px;
            vertical-align: top;
        }
    </style>
    <script type="text/javascript" src="../../lib/fjs.core.debug.js"></script>
    <script type="text/javascript" src="../transport/transport.js"></script>
    <script type="text/javascript" src="../transport/ajaxTransport.js"></script>
    <script type="text/javascript" src="../transport/XHRTransport.js"></script>
    <script type="text/javascript" src="../transport/XDRTransport.js"></script>
    <script type="text/javascript" src="../transport/IframeTransport.js"></script>
    <script type="text/javascript" src="../transport/localStorageTransport.js"></script>
    <script type="text/javascript" src="../transport/transportFactory.js"></script>
    <script type="text/javascript" src="../db/IndexedDBProvider.js"></script>
    <script type="text/javascript" src="../db/WebSQLProvider.js"></script>
    <script type="text/javascript" src="../db/DBFactory.js"></script>
    <script type="text/javascript" src="tabsSyncronizer.js"></script>
    <script type="text/javascript" src="sync_manager.js"></script>
    <script type="text/javascript" src="../properties.js"></script>
</head>
<body>
<label>Auth ticket: <input type="test" id="authTicket" /></label><br/>
<label>Node: <input type="test" id="node" /></label><br/>
<button onclick="runSyncronization()">Run</button>

<div>
    <div id="syncLog"></div>
    <div id="errorsLog"></div>
    <div id="nodeLog"></div>
</div>
<script>
    var sync_manager = new fjs.fdp.SyncManager(fjs.fdp.CONFIG);
    document.getElementById('authTicket').value = '44173f3c959f643a9208e0354c41e98d2692d606d9b17997';//fjs.utils.Cookies.get('Authorization');
    document.getElementById('node').value = "";//fjs.utils.Cookies.get('node');
    function runSyncronization() {
        sync_manager.init(document.getElementById('authTicket').value, null, {requestAuth:function(){console.log('requestAuth')}, setNode:function(){console.log('setNode')}}, function(){
            console.log('SM Ready!');
            sync_manager.addListener('me', function(e) {
                console.log(e);
                document.getElementById('syncLog').innerHTML += '<div>' + e.eventType + (e.eventType=='push' ? '<b>'+ e.entry.propertyKey+'</b> - <i>'+e.entry.propertyValue+'</i>' : '' )+ '</div>';
            });
        })
    }
    runSyncronization();
</script>
</body>
</html>